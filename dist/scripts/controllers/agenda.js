define(["controllers/controllers","config"],function(e,t){e.controller("agenda",["$rootScope","$scope","$q","$window","$location","Dater","$timeout","Store","Teams","Clients","TeamUp","Session","Slots","data",function(e,n,r,i,s,o,u,a,f,l,c,h,p,d){e.notification.status=!1,e.fixStyles(),n.self=this,n.data=d.timelineData;var v=a("app").get("teams");n.current={layouts:{user:!0,group:!0,members:d.userData.uuid!=e.app.resources.uuid},day:moment().format("DDD"),week:moment().week(),month:o.current.month(),year:o.current.year(),group:n.data.groupId,division:"all"},n.periods=o.getPeriods(),n.periodsNext=o.getPeriods(!0),e.infoAvailibility=a("app").get("infoAvail")||{},_.isUndefined(e.infoAvailibility.info)&&(a("app").save("infoAvail",{info:!0}),e.infoAvailibility.info=!0),e.disableInfoAvailibility=function(){a("app").save("infoAvail",{info:!1}),e.infoAvailibility.info=!1},n.slot={};var m=o.current.today()>360?{start:n.periods.days[358].last.timeStamp,end:n.periods.days[365].last.timeStamp}:{start:n.periods.days[o.current.today()-1].last.timeStamp,end:n.periods.days[o.current.today()+6].last.timeStamp},g=t.app.timeline;n.timeline={id:"mainTimeline",main:!0,user:{id:d.userData.uuid,role:d.userData.role,fullName:d.userData.fullName},current:n.current,options:{start:m.start,end:m.end,min:m.start,max:m.end},range:{start:m.start,end:m.end},scope:{day:!1,week:!0,month:!1},config:{bar:g.config.bar,layouts:g.config.layouts,wishes:g.config.wishes,legenda:{},legendarer:g.config.legendarer,states:g.config.states,divisions:g.config.divisions,densities:g.config.densities}},$.browser.msie&&$.browser.version=="8.0"&&(n.timeline.options={start:n.periods.days[o.current.today()].last.timeStamp,end:n.periods.days[o.current.today()+7].last.timeStamp,min:n.periods.days[o.current.today()].last.timeStamp,max:n.periods.days[o.current.today()+7].last.timeStamp}),_.each(t.app.statesall,function(e,t){n.timeline.config.legenda[t]=!0}),n.timeline.config.legenda.groups={more:!0,even:!0,less:!0},n.daterange=o.readable.date(n.timeline.range.start)+" / "+o.readable.date(n.timeline.range.end),u(function(){n.states={},_.each(n.timeline.config.states,function(e,t){n.states[t]=e.label})}),n.groups=v,n.divisions=n.timeline.config.divisions,n.timeline.config.divisions.length>0&&(n.divisions[0].id!=="all"&&n.divisions.unshift({id:"all",label:"Alle divisies"}),n.groupPieHide={},_.each(n.divisions,function(e){n.groupPieHide[e.id]=!1})),n.resetViews=function(){n.views={slot:{add:!1,edit:!1},group:!1,wish:!1,member:!1}},n.resetViews(),n.toggleSlotForm=function(){n.views.slot.add?(e.planboardSync.start(),n.resetInlineForms()):(e.planboardSync.clear(),e.$broadcast("slotInitials"),n.resetViews(),n.views.slot.add=!0)},n.refreshCurrentTimeline=function(){e.$broadcast("resetTimeline"),n.resetInlineForms()},n.resetInlineForms=function(){n.slot={},n.resetViews()},n.redirectOwnTimeline=function(){s.path("/team-telefoon/agenda/"+e.app.resources.uuid)}}])});