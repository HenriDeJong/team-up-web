define(["controllers/controllers"],function(e){e.controller("status",["$scope","$rootScope","$q","$window","$location","Slots","Teams","$timeout","Store","data",function(e,t,n,r,i,s,o,u,a,f){t.notification.status=!1,t.fixStyles();var l=a("app").get("teams"),c=t.unique(a("app").get("members")),h;l.unshift({name:t.ui.dashboard.everyone,uuid:"all"}),h="all",e.groups=l,e.states=angular.copy(t.config.app.timeline.config.states),e.states["no-state"]={className:"no-state",label:t.ui.dashboard.possiblyReachable,color:"#ececec",type:t.ui.dashboard.noPlanning,display:!1},e.current={group:h,division:"all"},e.loadingReachability=!0,e.getReachability=function(r){var i=n.defer();return r||(r=e.current.group),r=="all"?c=t.unique(a("app").get("members")):typeof f.members[r]!="undefined"&&(c=t.unique(f.members[r])),s.getAllMemberReachabilities(f.teams).then(function(n){var r={};_.each(n.members,function(n,i){if(c[i]&&c[i].role!=0&&c[i].role!=4){var s={id:i,state:n.length>0?n[0].state:"no-state",label:n.length>0?e.states[n[0].state].label[0]:"",end:n.length>0&&n[0].end!==undefined?n[0].end*1e3:t.ui.dashboard.possiblyReachable,name:c&&c[i]?c[i].firstName+" "+c[i].lastName:i};n.length>0?(r.reachable||(r.reachable=[]),r.unreachable||(r.unreachable=[]),n[0].state=="com.ask-cs.State.Unavailable"?r.unreachable.push(s):(n[0].state=="com.ask-cs.State.Available"&&(s.style="sa-icon-reserve-available"),r.reachable.push(s))):(r.possible||(r.possible=[]),r.possible.push(s))}}),e.loadingReachability=!1;var s=function(e,t){return e.end<t.end?-1:e.end>t.end?1:0};r.hasOwnProperty("reachable")&&r.reachable.sort(s),r.hasOwnProperty("unreachable")&&r.unreachable.sort(s);var o=[];_.each(r.reachable,function(e){e.state=="com.ask-cs.State.Available"&&o.push(e)}),r.reachable=o,e.reachability={members:r,synced:n.synced*1e3},i.resolve(e.reachability)},function(e){i.reject(e)}),i.promise},e.getGroupReachability=function(){var r=n.defer();return e.current.division="all",e.loadGroup=t.ui.dashboard.load,t.statusBar.display("team(s) "+t.ui.dashboard.loading),e.getReachability(e.current.group,e.current.division).then(function(n){r.resolve(n),e.loadGroup="",t.statusBar.off()},function(e){r.reject(e),t.statusBar.off()}),r.promise},e.getDivisionReachability=function(){e.getReachability(e.current.group,e.current.division)},e.getGroupReachability(),e.setPrefixedReachability=function(e,t){a("environment").save("setPrefixedReachability",{reachability:e,period:t}),i.path("/planboard").search({setPrefixedReachability:!0})}}])});