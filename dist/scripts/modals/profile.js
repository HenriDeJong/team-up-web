define(["services/services","config"],function(e,t){e.factory("Profile",["$rootScope","$resource","$q","Slots","MD5","Store",function(e,n,r,i,s,o){var u=n(t.app.host+"node/:id/:section",{},{get:{method:"GET",params:{id:"",section:"resource"}},save:{method:"PUT",params:{section:"resource"}},remove:{method:"DELETE",params:{},isArray:!0},role:{method:"PUT",params:{section:"role"},isArray:!0},membership:{method:"PUT",params:{id:"",section:"membership"},isArray:!0}}),a=n(t.app.host+"node/:id/pincode_exists",{},{check:{method:"GET",params:{}}}),f=n(t.app.host+"resources",{},{get:{method:"GET",params:{}},save:{method:"POST",params:{},isArray:!0}}),l=n(t.app.host+"team/:teamId/member/:userId",{},{get:{method:"GET",params:{}},save:{method:"PUT",params:{}}});return u.prototype.fetchUserData=function(t){var n=r.defer();return _.isUndefined(t)||l.get({userId:t},function(r){t==e.app.resources.uuid&&(e.app.resources=r,o("app").save("resources",r)),n.resolve(r)},function(e){n.resolve({error:e})}),n.promise},u.prototype.saveUserData=function(e){var t=r.defer();return e.length&&!_.isUndefined(e.uuid)&&l.save({teamId:e.teamUuids[0],userId:e.uuid},e,function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},u.prototype.userExists=function(e){var t=r.defer();return(e!=""||e.length>0)&&UserExists.check({username:e},function(){t.resolve(!0)},function(){t.resolve(!1)}),t.promise},u.prototype.pincodeExists=function(e,t){var n=r.defer();return(t!=""||t.length>0)&&a.check({id:e,pincode:t},function(){n.resolve(!0)},function(){n.resolve(!1)}),n.promise},u.prototype.role=function(e,t){var n=r.defer();return u.role({id:e},t,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},u.prototype.changePassword=function(e){var t=r.defer();return f.save(null,{askPass:s(e.new1)},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},u.prototype.membership=function(e,t){var n=r.defer();return u.membership({id:e},t,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},u.prototype.get=function(e,t){var n=r.defer();return u.get({id:e},function(e){n.resolve(e)}),n.promise},u.prototype.getWithSlots=function(e,t,n){var s=r.defer();return u.prototype.get(e,t).then(function(t){i.user({user:e,start:n.start,end:n.end}).then(function(e){s.resolve(angular.extend(t,{slots:e,synced:(new Date).getTime(),periods:{start:n.start*1e3,end:n.end*1e3}}))})}),s.promise},u.prototype.getSlots=function(e,t){var n=r.defer();return i.user({user:e,start:t.start/1e3,end:t.end/1e3}).then(function(e){n.resolve({slots:e,synced:(new Date).getTime(),periods:{start:t.start,end:t.end}})}),n.promise},u.prototype.local=function(){return o("app").get("resources")},u.prototype.save=function(e,t){var n=r.defer();return t.firstName!=undefined&&t.lastName!=undefined&&(t.name=t.firstName+" "+t.lastName),u.save({id:e},t,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},u.prototype.remove=function(e){var t=r.defer();return u.remove({id:e},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},new u}])});