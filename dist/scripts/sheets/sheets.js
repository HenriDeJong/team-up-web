function fixdata(e){var t="",n=0,r=10240;for(;n<e.byteLength/r;++n)t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(n*r,n*r+r)));return t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(n*r))),t}function ab2str(e){var t="",n=0,r=10240;for(;n<e.byteLength/r;++n)t+=String.fromCharCode.apply(null,new Uint16Array(e.slice(n*r,n*r+r)));return t+=String.fromCharCode.apply(null,new Uint16Array(e.slice(n*r))),t}function s2ab(e){var t=new ArrayBuffer(e.length*2),n=new Uint16Array(t);for(var r=0;r!=e.length;++r)n[r]=e.charCodeAt(r);return[n,t]}function xlsxworker_noxfer(e,t){var n=new Worker("./xlsxworker.js");n.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;case"xlsx":t(JSON.parse(e.data.d))}};var r=rABS?e:btoa(fixdata(e));n.postMessage({d:r,b:rABS})}function xlsxworker_xfer(e,t){var n=new Worker(rABS?"./xlsxworker2.js":"./xlsxworker1.js");n.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;default:xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"),console.log("done"),t(JSON.parse(xx))}};if(rABS){var r=s2ab(e);n.postMessage(r[1],[r[1]])}else n.postMessage(e,[e])}function xlsxworker(e,t){transferable=document.getElementsByName("xferable")[0].checked,transferable?xlsxworker_xfer(e,t):xlsxworker_noxfer(e,t)}function get_radio_value(e){var t=document.getElementsByName(e);for(var n=0;n<t.length;n++)if(t[n].checked||t.length===1)return t[n].value}function to_json(e){var t={};return e.SheetNames.forEach(function(n){var r=XLSX.utils.sheet_to_row_object_array(e.Sheets[n]);r.length>0&&(t[n]=r)}),t}function to_csv(e){var t=[];return e.SheetNames.forEach(function(n){var r=XLSX.utils.sheet_to_csv(e.Sheets[n]);r.length>0&&(t.push("SHEET: "+n),t.push(""),t.push(r))}),t.join("\n")}function to_formulae(e){var t=[];return e.SheetNames.forEach(function(n){var r=XLSX.utils.get_formulae(e.Sheets[n]);r.length>0&&(t.push("SHEET: "+n),t.push(""))}),t.join("\n")}function b64it(){typeof console!="undefined"&&console.log("onload",new Date);var e=XLSX.read(tarea.value,{type:"base64",WTF:wtf_mode});process_wb(e)}function addBreadcrumb(e){var t=$("#breadcrumb"),n=t.contents().last().wrap('<a href="#">');t.append(e)}function process_wb(e){addBreadcrumb("Week kiezen");var t=$("#UploadStepSelectSheet");t.show();for(sheetName in e.Sheets)$("<div class='SheetDiv'>").append(sheetName).appendTo(t).click(sheetName,function(t){$("#UploadStepSelectSheet").hide(),addBreadcrumb("Controleren"),process_sheet(e.Sheets[t.data]),$("#UploadStepCheckResult").show()})}function process_sheet(e){console.log(e);var t;try{t=new TeamUpSpreadsheet(e);for(var n=0;n<t.errors.length;n++)$("#UploadStepShowErrors").append("<p>"+t.errors[n].code+": "+t.errors[n].text+"</p>");var r=null,i;for(var s=0;s<t.routes.length;s++){var o=t.routes[s];if(r===null||r!=o.startDate)r=o.startDate,i=$("<div class='SheetDayDiv'><h2>"+getWeekdayName(r)+"</h2></div>").appendTo($("#UploadStepShowRoutes"));var u=$("<div class='SheetRouteDiv'><h3>"+o.name+"</h3></div>").appendTo(i),a=t.routes[s].tasks;for(var f=0;f<a.length;f++){var l=a[f],c=$("<div class='SheetTaskDiv'>").appendTo(u),h=l.startTime;h===null&&console.log("Start time is null"),c.append("<div class='SheetTaskStartDiv'>"+h.getHours()+":"+h.getMinutes()+"</div>"),c.append("<div class='SheetTaskClientDiv'>"+l.clientName+"</div>"),c.append("<div class='SheetTaskDurationDiv'>"+l.duration+"</div>")}}}catch(p){console.log(p)}}function TeamUpTimeWindow(e,t){this.startTime=e,this.endTime=t}function getWeekdayName(e){var t=e.getDay();return weekdayNames[t]}function getDateFromCell(e){try{if(e.t=="n"&&typeof e.v=="number"&&typeof e.w=="string"&&e.v>0&&e.v<2958465){var t=XLSX.SSF.parse_date_code(e.v,{date1904:!1},!1);return new Date(t.y,t.m-1,t.d)}return null}catch(n){return console.log("getDateFromCell(): Cell ("+typeof e+") is "+e),null}}function getSheetCellName(e,t){var n=XLSX.utils.encode_cell({c:e,r:t});return n}function getSheetCell(e,t,n){var r=getSheetCellName(t,n),i=e[r];return i}function getCellValue(e){var t=null;return e.v?t=e.v.toLowerCase().trim():console.log("Trying to read wrong value"),t}function getStartTimeFromCellAndDate(e,t){var n=/([0-9]{1,2})[^0-9]{1}([0-9]{1,2})/,r=e.v.match(n);if(r===null)return null;var i=r[1],s=r[2],o=new Date(t);return o.setHours(i),o.setMinutes(s),o}function getCellStringValue(e){var t=null;return typeof e!="undefined"&&(e.t==="s"||e.t==="str")&&(t=e.v.toLowerCase().trim()),t}function TeamUpSpreadsheet(e){function t(e){for(var t=0;t<this.maxRange.e.c;t++){var n=getSheetCell(e,t,this.periodHeaderRow);if(typeof n=="undefined")continue;var r=getDateFromCell(n);r!==null&&(t<3&&(this.periodHeaderRows=this.findPeriodHeaders(e,t,this.periodHeaderRow+1)),this.periodStartColumns[t]=r)}console.log(this.periodHeaderRows);for(var t in this.periodStartColumns)for(var i in this.periodHeaderRows){var s=parseInt(i)+1;console.log("Reading next route starting at "+getSheetCellName(t,s));var o={startDate:this.periodStartColumns[t],teamMemberName:null,tasks:[],name:this.periodHeaderRows[i]};for(var u=s;u<this.maxRange.e.r;u++){if(typeof this.periodHeaderRows[u]!="undefined")break;if(o.teamMemberName===null)for(var a=-1;a<=1;a++){var f=parseInt(t)+a,n=getSheetCell(e,t,u),l=getCellStringValue(n);l!==null&&(o.teamMemberName=l)}else{var c={startTime:null,clientName:null,duration:0};for(var a=-1;a<=1;a++){var f=parseInt(t)+a,h=getSheetCellName(f,u),n=e[h];if(typeof n=="undefined")break;switch(n.t){case"b":a==-1?this.errors.push({code:1001,text:"Er is een ja/nee waarde gevonden in cell "+h+", terwijl er een tijdstip werd verwacht."}):a==0?this.errors.push({code:1002,text:"Er is een ja/nee waarde gevonden in cell "+h+", terwijl er een clientnaam werd verwacht."}):a==1&&this.errors.push({code:1003,text:"Er is een ja/nee waarde gevonden in cell "+h+", terwijl er een aantal minuten werd verwacht."});break;case"n":a==-1?this.errors.push({code:1004,text:"Er is een getal gevonden in cell "+h+", terwijl er een tijdstip werd verwacht."}):a==0?this.errors.push({code:1005,text:"Er is een getal gevonden in cell "+h+", terwijl er een clientnaam werd verwacht."}):a==1&&(c.duration=parseInt(n.v));break;case"e":this.errors.push({code:1006,text:"Er is een fout gevonden in cell "+h+": "+n.v});break;case"s":case"str":if(a==-1){var p=getStartTimeFromCellAndDate(n,o.startDate);p===null?(this.errors.push({code:1007,text:"Het is niet mogelijk om het tijdstip in cell "+h+" te lezen."}),c=null):c.startTime=p}else a==0?c.clientName=getCellStringValue(n):a==1&&(c.duration=parseInt(n.v))}if(c===null)break}c!==null&&c.startTime!==null&&c.clientName!==null&&o.tasks.push(c)}}this.routes.push(o)}}function n(e,t,n){var r={},i=null;for(var s=n;s<this.maxRange.e.r;s++)for(var o=-1;o<=1;o++)try{var u=t+o;cell=getSheetCell(e,u,s);if(typeof cell=="undefined")continue;var a=getCellStringValue(cell);if(a===null||a.length==0)continue;if(a.indexOf("fbpz")>=0)break;if(this.dayparts.indexOf(a)>=0){console.log("Found a daypart: "+a),i=a;var f=!1,l=getSheetCell(e,u,s+1);if(l){var c=getCellStringValue(l);c!==null&&c.indexOf("route")>=0&&(f=!0)}if(f===!1){var h=i;r[s]=h}break}if(a.indexOf("route")==0){if(i===null)throw"Found a route without having a daypart.";var h=i+" "+a;r[s]=h;break}}catch(p){return console.log(p),console.log(p.stack),r}return r}if(e==null||e["!ref"]==null)return"";this.nofColumnsPerPeriod=3,this.firstPeriodColumn=0,this.periodHeaderRow=1,this.maxRange=XLSX.utils.decode_range(e["!ref"]),this.dayparts=["ochtend","namiddag","avond","middag","nacht"],this.periodHeaderRows={},this.periodStartColumns={},this.teamMemberNames=[],this.routes=[],this.errors=[],this.parseSheet=t,this.findPeriodHeaders=n,this.parseSheet(e)}var tarea=document.getElementById("b64data"),weekdayNames=["Zondag","Maandag","Dinsdag","Woensdag","Donderdag","Vrijdag","Zaterdag","Zondag"];