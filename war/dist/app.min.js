/*!
 * OneLine v0.1.0 (snapshot)
 * Ask Community Systems
 * Authors: Cengiz Ulusoy
 * 28-04-2014 03:04
 */
var ui={en:{meta:{name:"en",label:"English"},login:{header:"Please sign in",placeholder_username:"Please enter your username",placeholder_password:"Your password",label_rememberMe:"Remember Me",button_login:"Login",button_loggingIn:"Logging...",forgot_password:"Forgot password?",forgetPassword:"Forgot password",emailAddress:"Email address",resetPassword:"Reset Password",returnLogin:"return back to login",changePassword:"change password",downloadApp:"Download Mobile App",ph_username:"username",ph_newPass:"new  password",ph_retypePass:"retype password",alert_fillfiled:"Please fill all fields!",alert_wrongUserPass:"Wrong username or password!",alert_network:"Network error",loading_User:"Loading user information...",loading_Message:"Loading messages...",loading_Teams:"Loading Teams...",loading_Members:"Loading members...",loading_everything:"Everything loaded!",logout:"Logout",loading:"Loading..",loading_clientGroups:"Loading client groups..."},dashboard:{thisWeek:"This Week",welcome:"Welcome",newMessage:"New Messages",goToInbox:"Go to inbox",announcements:"Announcements",loadingPie:"Loading pie charts...",loadingP2000:"Loading alarm messages",noP2000:"There are no alarm messages"},planboard:{planboard:"Agenda",newAvail:"New Availability",day:"Day",week:"Week",month:"Month",updateAvail:"Update Availability",from:"From",till:"Till",state:"State",selectAState:"select a state",reoccuring:"Re-occuring",lessPeople:"There $v less people than needed!",samePeople:"There are just as many people as needed.",morePeople:"There are $v more people than needed!",wished:"Wished",combine_reoccuring:"This is a combined row of planning with re-occuring rows.",sendMsgToMember:"Send Message To Members",add:"Add",del:"Delete",change:"Change",setWish:"Set Wish",timeline:"Timeline",statistics:"Statistics",barCharts:"Bar charts",wishes:"Wishes",legenda:"Legenda",group:"Group",groups:"Groups",members:"Members",bothAvailable:"Both available",northAavailable:"available North",southAvailable:"available South",skipperOutService:"Skipper Of Service",notAvailable:"Not Available",notachieve:"Not Achieved",legendaLabels:{morePeople:"More people",enoughPeople:"Just enough people",lessPeople:"Less people"},lastSyncTime:"Last sync time:",dataRangeStart:"Data range start: ",DataRangeEnd:"Data range end: ",loadingTimeline:"Loading timeline...",addTimeSlot:"Adding a timeslot...",slotAdded:"New timeslot added successfully.",changingSlot:"Changing a timeslot...",slotChanged:"Timeslot changed successfully.",changingWish:"Changing wish value...",wishChanged:"Wish value changed successfully.",deletingTimeslot:"Deleting a timeslot...",timeslotDeleted:"Timeslot deleted successfully.",refreshTimeline:"Refreshing timeline...",preCompilingStortageMessage:"Pre-compiling shortage message",weeklyPlanning:"Weekly planning",planning:"Planning",minNumber:"Minimum number benodigden"},message:{messages:"Messages",composeAMessage:"Compose a message",compose:"Compose",inbox:"Inbox",outbox:"Outbox",trash:"Trash",composeMessage:"Compose message",close:"Close",broadcast:"Broadcast",sms:"SMS",email:"Email",receviers:"Recevier(s)",subject:"Subject",message:"Message",sendMessage:"Send Message",sender:"Sender",date:"Date",questionText:"Message",reply:"Reply",del:"Delete",noMessage:"There are no messages.",from:"From",newMsg:"New",deleteSelected:"Delete Selected Messages",someMessage:"There are $v message(s)",emptyTrash:"Empty Trash",noMsgInTrash:"There are no messages in trash.",box:"Box",persons:"Person(s)",restoreSelected:"Restore Selected Messages",loadingMessage:"Loading message...",escalation:"Escalation message",escalationBody:function(a,b,c,d,e){return"We have "+a+" shortage in between "+b+" "+c+" and "+d+" "+e+". Would you please make yourself available if you are available for that period?"},removed:"Message removed successfully.",removing:"Removing the message...",refreshing:"Refreshing messages...",removingSelected:"Removing selected messages...",restoring:"Restoring the message back...",restored:"Message restored successfully.",restoringSelected:"Restoring selected messages...",emptying:"Emptying trash...",emptied:"Trash bin emptied successfully.",sending:"Sending the message...",sent:"Message sent.",typeSubject:"Type a subject",ph_filterMessage:"Filter messages..",noReceivers:"Please select a receiver.",emptyMessageBody:"Please write a message",send:"Send"},groups:{groups:"Groups",newGroup:"New Group",newMember:"New Member",serach:"Search",addNewGroup:"Add New Group",editGroup:"Edit Group",searchResults:"Search results",group:"Group",close:"Close",name:"Name",saveGroup:"Save Group",registerMember:"Register Member",role:"Role",selectRole:"Select a role",selectGroup:"Choose a group",email:"Email",phone:"Phone",address:"Address",postCode:"Postcode",tel:"Tel",city:"City",userName:"Username",password:"Password",saveMember:"Save Member",serachFor:"Search results for ",sorryCanNotFind:"Sorry but we couldn't find what you are looking for.",addToGroup:"Add to group",addMemberToGroup:"Add Selected Members To Groups",resultCount:"There are $v results in your query.",deleteGroup:"Delete Group",noMembers:"There are no members.",removeSelectedMembers:"Remove Selected Members",memberCount:"There are $v member(s)",searchingMembers:"Searching members..",addingNewMember:"Adding a new member..",memberAdded:"Member added to group successfully.",refreshingGroupMember:"Refreshing groups and members list..",removingMember:"Removing member from group..",memberRemoved:"Member removed from group successfully.",removingSelected:"Removing selected members..",saving:"Saving group..",groupSaved:"Group saved successfully.",registerNew:"Registering a new member..",memberRegstered:"Member registered successfully.",deleting:"Deleting group..",deleted:"Group deleted successfully.",filterMembers:"Filter members..",searchfor:"firstname, lastname.."},profile:{profile:"Profile",edit:"Edit",password:"Password",timeline:"Timeline",profileView:"Profile View",userGroups:"User Groups",role:"Role",email:"Email",phone:"Phone",address:"Address",postcode:"Postcode",city:"City",editProfile:"Edit Profile",name:"Name",saveProfile:"Save Profile",passChange:"Password Change",currentPass:"Current password",newPass:"New password",newPassRepeat:"New password (Repeat)",changePass:"Change password",newAvail:"New Availability",refreshing:"Refreshing profile information..",dataChanged:"Profile data is succesfully changed.",pleaseFill:"Please fill all fields!",passNotMatch:"Provided passwords do not match! Please try it again.",changingPass:"Changing password..",passChanged:"Password is succesfully changed.",passwrong:"Given current password is wrong! Please try it again.",newTimeslotAdded:"New timeslot added successfully.",changingTimeslot:"Changing a timeslot..",timeslotChanged:"Timeslot is succesfully changed.",firstName:"first name",lastName:"last name",editProfileImg:"Edit profile image",loadUploadURL:"Loading image upload URL ",click2upload:"click here to upload",birthday:"Birthday",username:"username",retypePassword:"retype password"},settings:{settings:"Settings",user:"User",application:"Application",userSettings:"User Settings",appSettings:"Application Settings",saveSettings:"Save Settings",langSetting:"Language",saving:"Saving settings...",refreshing:"Refreshing settings...",saved:"Settings successfully saved."},help:{header:"Help & Support",support:"Support"},downloads:{app:"Soon it will be downloadable.<br>",manual:"Download Manual"},loading:{general:"Loading",dashboard:"dashboard",planboard:"agenda",messages:"messages",groups:"groups",profile:"profile",settings:"settings"},teamup:{teams:"teams",clients:"clients",client:"client",manage:"manage",chooseTeam:"choose a team",edit:"edit",editTeam:"edit team",team:"team",del:"delete",noMembers:"No members in this team.",newTeam:"New Team",teamName:"Team name",createTeam:"Create New Team",newMember:"New Member",name:"Name",role:"role",phone:"phone",street:"street",postCode:"post",city:"city",saveMember:"Save",state:"state",states:"States",saveTeam:"Saving team",save:"Save",refreshing:"Refreshing team info",dataChanged:"Data is changed",teamSubmitError:"Errors in creating the team",queryTeamError:"Errors in quering the teams",teamNamePrompt1:"Team name can not be empty",teamNamePrompt2:"Please fill the conatct data",cancel:"Cancel",chooseRole:"Choose a role",func:"function",chooseFunction:"Choose a function",newClientGroup:"New Group",newClient:"New Client",reports:"Reports",report:"Report",noClients:"There are no clients in this group",TeamClients:"TEAMS-CLIENTS",createClientGroup:"Create new client group",contacts:"Contacts",Number:"No",clientProfileUrl:"Client profile URL",addContact:"add contact",saveClient:"Save",group:"Group",noContacts:"There is no contact person.",contactCount:"There are $v contact(s)",accountInfoFill:"Please fill your account info.",passNotSame:"Passwrods are not same.",savingMember:"Saving member",selectTeam:"Please select a team",clinetInfoFill:"Please fill the basic client info : name and phone",savingClient:"Saving client",clientSubmitError:"Errors when creating new client",clientGroups:"Client groups",teams_Cap:"Teams",editClient:"Edit client",loadingNumber:"loading call-in number of this team",birthdayError:"Birthday error",map:"map",saveContacts:"Save contacts",loadingReports:"Loading reports",datetime:"Date & time",writenBy:"written by",noSharedStates:"No shared states",savingContacts:"Saving the contacts",delClientGroupConfirm:"Are you sure you want to delete this client group ? It might take a while.",delTeamConfirm:"Are you sure you want to delet this team ? It might take a while.",deletingClientGroup:"Deleting group ... ",deleteConfirm:"Please OK to process.",deletingTeam:"Deleting team ...",deletingMember:"Deleting member ...",deletingClient:"Deleting client ...",noMessages:"There are no messages",newReport:"New Report",selectClient:"Select a client",selectMember:"Select a member",selectMonth:"Select a month",saveReport:"Save report",reportTitle:"Title",selectSlot:"Please select a slot",editClientImg:"Edit client image",newTask:"New Task",updateTask:"Update Task",managePanelchangePrompt:"You did some changes , save it ?"}},nl:{meta:{name:"nl",label:"Nederlands"},login:{header:"Inloggen",placeholder_username:"Vul uw gebruikersnaam in",placeholder_password:"Vul uw wachtwoord in",label_rememberMe:"Onthoud mij",button_login:"Login",button_loggingIn:"Inloggen...",forgot_password:"Wachtwoord vergeten?",forgetPassword:"Wachtwoord vergeten",emailAddress:"Email adres",resetPassword:"Wachtwoord opnieuw instellen",returnLogin:"Terugkeren om in te loggen",changePassword:"Wachtwoord wijzigen",downloadApp:"Download Mobiele App",ph_username:"gebruikersnaam",ph_newPass:"nieuw wachtwoord",ph_retypePass:"Typ wachtwoord",alert_fillfiled:"Vul alle velden in!",alert_wrongUserPass:"Onjuiste gebruikersnaam of wachtwoord!",loading_User:"Gebruikersinformatie laden...",loading_Message:"Berichten laden...",loading_Group:"Groepen laden...",loading_Members:"Leden laden...",loading_everything:"Alles is geladen!",logout:"Logout",loading:"Loading..",loading_clientGroups:"Loading client groups..."},dashboard:{thisWeek:"Deze week",welcome:"Welkom",newMessage:"Nieuwe berichten",goToInbox:"Ga naar inbox",loadingPie:"Cirkeldiagrammen laden...",announcements:"Alarm berichten",loadingP2000:"Alarm berichten laden...",noP2000:"Er zijn geen alarm berichten."},planboard:{planboard:"Agenda",newAvail:"Nieuwe beschikbaarheid",day:"Dag",week:"Week",month:"Maand",updateAvail:"Update beschikbaarheid",from:"Van",till:"Tot",state:"Status",selectAState:"selecteer een status",reoccuring:"Herhaling",lessPeople:"Er is een tekort van $v mens(en)!",samePeople:"Er zijn precies genoeg mensen.",morePeople:"Er is een overschot van $v mens(en)!",wished:"Gewenst",combine_reoccuring:"Dit is een gecombineerde planning.",sendMsgToMember:"Stuur bericht naar leden",add:"Toevoegen",del:"Verwijderen",change:"Wijzigen",setWish:"Behoefte instellen",timeline:"Tijdlijn",statistics:"Statistieken",barCharts:"Staafdiagrammen",wishes:"Behoefte",legenda:"Legenda",group:"Groep",groups:"Groepen",members:"Leden",bothAvailable:"Beiden beschikbaar",northAavailable:"Beschikbaar Noord",southAvailable:"Beschikbaar Zuid",skipperOutService:"Schipper van dienst",notAvailable:"Niet beschikbaar",notachieve:"Niet behaald",legendaLabels:{morePeople:"Meer mensen",enoughPeople:"Precies genoeg mensen",lessPeople:"Te weinig mensen"},lastSyncTime:"Laatste synchronisatietijd:",dataRangeStart:"Begin gegevensscala: ",DataRangeEnd:"Eind gegevensscala: ",loadingTimeline:"Tijdlijn laden...",addTimeSlot:"Tijdslot toevoegen...",slotAdded:"Tijdslot succesvol toegevoegd.",changingSlot:"Tijdslot wijzigen...",slotChanged:"Tijdslot succesvol gewijzigd.",changingWish:"Behoefte veranderen...",wishChanged:"Behoefte succesvol veranderd.",deletingTimeslot:"Tijdslot verwijderen...",timeslotDeleted:"Tijdslot succesvol verwijderd.",refreshTimeline:"Tijdlijn vernieuwen...",preCompilingStortageMessage:"Opstellen tekortbericht",weeklyPlanning:"Wekelijkse planning",planning:"Planning",minNumber:"Minimum aantal benodigde mensen"},message:{messages:"Berichten",composeAMessage:"Bericht opstellen",compose:"Opstellen",inbox:"Inbox",outbox:"Outbox",trash:"Prullenbak",composeMessage:"Bericht opstellen",close:"Sluiten",broadcast:"Extra medium",sms:"SMS",email:"Email",receviers:"Ontvanger(s)",subject:"Onderwerp",message:"Bericht",sendMessage:"Bericht versturen",sender:"Zender",date:"Datum",questionText:"Bericht",reply:"Antwoorden",del:"Verwijderen",noMessage:"Er zijn geen berichten.",from:"Van",newMsg:"Nieuw",deleteSelected:"Verwijder geselecteerde berichten",someMessage:"Er zijn $v berichten",emptyTrash:"Prullenbak legen",noMsgInTrash:"Er zijn geen berichten.",box:"Box",persons:"Personen",restoreSelected:"Geselecteerde berichten terugplaatsen",loadingMessage:"Bericht laden...",escalation:"Escalatiebericht",escalationBody:function(a,b,c,d,e){return"Er is een tekort van "+a+" mensen tussen "+b+" "+c+" en "+d+" "+e+". Zet uzelf a.u.b. op beschikbaar indien u beschikbaar bent voor die periode"},removed:"Bericht succesvol verwijderd.",removing:"Bericht verwijderen...",refreshing:"Bericht vernieuwen...",removingSelected:"Geselecteerde berichten verwijderen...",restoring:"Bericht terugplaatsen...",restored:"Bericht succesvol teruggeplaatst.",restoringSelected:"Geselecteerde berichten terugplaatsen...",emptying:"Prullenbak leegmaken...",emptied:"Prullenbak succesvol geleegd.",sending:"Bericht versturen...",sent:"Bericht verstuurd.",typeSubject:"Vul een onderwerp in",ph_filterMessage:"Berichten filteren...",noReceivers:"Graag een ontvanger selecteren.",emptyMessageBody:"The message is empty, please write a message",send:"Send"},groups:{groups:"Groepen",newGroup:"Nieuwe Group",newMember:"Nieuw lid",serach:"Zoeken",addNewGroup:"Nieuwe groep toevoegen",editGroup:"Groep wijzigen",searchResults:"Zoekresultaten",group:"Groep",close:"Sluiten",name:"Naam",saveGroup:"Groep opslaan",registerMember:"Lid registreren",role:"Functie",selectRole:"Selecteer een functie",email:"Email",phone:"Telefoon",address:"Adres",postCode:"Postcode",tel:"Tel",city:"Stad",userName:"Gebruikersnaam",password:"Wachtwoord",saveMember:"Lid opslaan",serachFor:"Zoekresultaten voor ",sorryCanNotFind:"Sorry, geen resultaten.",addToGroup:"Aan groep toevoegen",addMemberToGroup:"Voeg geselecteerde leden aan groep toe",resultCount:"Er zijn $v resultaten.",deleteGroup:"Groep verwijderen",noMembers:"Er zijn geen leden.",removeSelectedMembers:"Geselecteerde leden verwijderen",memberCount:"Er zijn $v leden",searchingMembers:"Leden zoeken...",addingNewMember:"Nieuw lid toevoegen...",memberAdded:"Lid succesvol aan groep toegevoegd.",refreshingGroupMember:"Groepen- en ledenlijst vernieuwen...",removingMember:"Lid van groep verwijderen...",memberRemoved:"Lid succesvol van groep verwijderd.",removingSelected:"Geselecteerde leden verwijderen...",saving:"Groep opslaan...",groupSaved:"Groep succesvol opgeslagen.",registerNew:"Nieuw lid registreren...",memberRegstered:"Lid succesvol geregistreerd.",deleting:"Groep verwijderen...",deleted:"Groep succesvol verwijderd.",filterMembers:"Leden filteren...",searchfor:"voornaam, achternaam.."},profile:{profile:"Profiel",edit:"Wijzigen",password:"Wachtwoord",timeline:"Tijdlijn",profileView:"Profiel weergave",userGroups:"Gebruikersgroepen",role:"Functie",email:"Email",phone:"Telefoon",address:"Adres",postcode:"Postcode",city:"Stad",editProfile:"Profiel wijzigen",name:"Naam",saveProfile:"Profiel opslaan",passChange:"Wachtwoord wijzigen",currentPass:"Huidig wachtwoord",newPass:"Nieuw wachtwoord",newPassRepeat:"Herhaal nieuw wachtwoord",changePass:"Wachtwoord wijzigen",newAvail:"Nieuwe beschikbaarheid",refreshing:"Profielinformatie vernieuwen...",dataChanged:"Profielgegevens succesvol gewijzigd.",pleaseFill:"Vul a.u.b. alle velden in!",passNotMatch:"Ingevoerd wachtwoord komt niet overeen. Probeer het opnieuw.",changingPass:"Wachtwoord wijzigen...",passChanged:"Wachtwoord succesvol gewijzigd.",passwrong:"Ingevoerd wachtwoord is foutief! Probeer het opnieuw.",newTimeslotAdded:"Nieuw tijdslot succesvol toegevoegd.",changingTimeslot:"Tijdslot wijzigen...",timeslotChanged:"Tijdslot succesvol gewijzigd.",firstName:"Voornaam",lastName:"Achternaam",editProfileImg:"Profile foto wijzigen",loadUploadURL:"Foto upload URL laden",click2upload:"Klik hier om te uploaden",birthday:"Geboortedag",username:"Gebruikersnaam",retypePassword:"Nogmaals wachtwoord"},settings:{settings:"Instellingen",user:"Gebruiker",application:"Applicatie",userSettings:"Gebruikersinstellingen",appSettings:"Applicatie-instellingen",saveSettings:"Instellingen Opslaan",langSetting:"Taal",saving:"Instellingen wijzigen...",refreshing:"Instellingen vernieuwen...",saved:"Instellingen succesvol gewijzigd."},help:{header:"Hulp & Ondersteuning",support:"Ondersteuning"},downloads:{app:"Binnenkort te downloaden.",manual:"Download Handleiding"},loading:{general:"Laden",dashboard:"dashboard",planboard:"agenda",messages:"berichten",groups:"groepen",profile:"profiel",settings:"instellingen"},teamup:{teams:"teams",clients:"cliënten",manage:"beheren",chooseTeam:"Selecteer een team",edit:"bewerk",editTeam:"bewerk team",team:"team",del:"verwijder",noMembers:"Geen leden in dit team",newTeam:"Nieuw Team",teamName:"Teamnaam",createTeam:"Maak nieuw team",newMember:"Nieuw lid",name:"Naam",role:"rol",phone:"telefoon",street:"straat",postCode:"postcode",city:"Stad",saveMember:"Opslaan",state:"status",states:"Status",saveTeam:"Team opslaan",save:"Opslaan",refreshing:"Team info opnieuw ophalen",dataChanged:"Data is veranderd",teamSubmitError:"Fouten tijdens aanmaken van het team",queryTeamError:"Fouten tijdens het opzoeken van de teams",teamNamePrompt1:"Teamnaam mag niet leeggelaten worden",teamNamePrompt2:"Voeg contact data toe a.u.b.",cancel:"Annuleren",chooseRole:"Kies een rol",func:"functie",chooseFunction:"Kies een functie",newClientGroup:"Nieuwe Groep",newClient:"Nieuwe cliënt",reports:"Rapporten",report:"Rapport",noClients:"Geen cliënten in deze groep",TeamClients:"TEAMS-CLIENTEN",createClientGroup:"Maak nieuwe cliënten groep aan",contacts:"Contacten",Number:"Nummer",clientProfileUrl:"URL Cliënten profiel",addContact:"contactpersoon toevoegen",saveClient:"Opslaan",group:"Groep",noContacts:"Er zijn geen contactpersonen gedefinieerd",contactCount:"Er zijn $v contactpersonen",accountInfoFill:"Vul uw account informatie in a.u.b.",passNotSame:"Wachtwoorden zijn niet hetzelfde.",savingMember:"Lid aan het opslaan",selectTeam:"Selecteer een team a.u.b.",clinetInfoFill:"Vul the basis cliënt informatie (naam en telefoon) in a.u.b.",savingClient:"Cliënt aan het opslaan",clientSubmitError:"Fouten bij het aanmaken van een nieuwe cliënt",clientGroups:"Cliënten groepen",teams_Cap:"Teams",editClient:"Bewerk client",loadingNumber:"Team telefoonnummer aan het laden",birthdayError:"Fout in the geboortedatum",map:"kaart",saveContacts:"Contactpersonen opslaan",loadingReports:"Rapporten laden",datetime:"Datum en tijd",writenBy:"Geschreven door",noSharedStates:"Geen gedeelde status",savingContacts:"Contactpersonen oplsaan",delClientGroupConfirm:"Weet u zeker dat u deze cliënten groep wil verwijderen? Het kan even duren.",delTeamConfirm:"Weet u zeker dat u dit team wil verwijderen? Het kan even duren.",deletingClientGroup:"Groep verwijderen ... ",deleteConfirm:"Druk op OK om door te gaan.",deletingTeam:"Team verwijderen...",deletingMember:"Lid verwijderen ...",deletingClient:"Cliënt verwijderen ...",noMessages:"Er zijn geen berichten",newReport:"Nieuw Rapport",selectClient:"Selecteer een cliënt",selectMember:"Selecteer een lid",selectMonth:"Selecteer een maand",saveReport:"Rapport opslaan",reportTitle:"Titel",selectSlot:"Selecteer een tijdsslot a.u.b.",editClientImg:"Wijzig foto van de cliënt",newTask:"Nieuwe Taak",updateTask:"Wijzig Taak",managePanelchangePrompt:'Data is changed. Click "Yes" to go on, "Cancel" to stay.'}}};angular.module("WebPaige",["ngResource","WebPaige.Modals.User","WebPaige.Modals.Core","WebPaige.Modals.Teams","WebPaige.Modals.Clients","WebPaige.Modals.Profile","WebPaige.Modals.Settings","WebPaige.Modals.Messages","WebPaige.Modals.Slots","WebPaige.Controllers.Login","WebPaige.Controllers.Forgotpass","WebPaige.Controllers.Register","WebPaige.Controllers.Logout","WebPaige.Controllers.Core","WebPaige.Controllers.Teams","WebPaige.Controllers.Clients","WebPaige.Controllers.Manage","WebPaige.Controllers.TreeGrid","WebPaige.Controllers.Planboard","WebPaige.Controllers.Timeline","WebPaige.Controllers.Timeline.Navigation","WebPaige.Controllers.Profile","WebPaige.Controllers.Messages","WebPaige.Services.Session","WebPaige.Services.Dater","WebPaige.Services.MD5","WebPaige.Services.Storage","WebPaige.Services.Strings","WebPaige.Services.Generators","WebPaige.Services.Sloter","WebPaige.Directives","$strap.directives","WebPaige.Filters","ui.bootstrap.modal"]),"localStorage"in window&&null!==window.localStorage&&basket.require({url:"libs/chosen/chosen.jquery.min.js"},{url:"libs/chaps/timeline/2.4.0/timeline_modified.min.js"},{url:"libs/bootstrap-datepicker/bootstrap-datepicker.min.js"},{url:"libs/bootstrap-timepicker/bootstrap-timepicker.min.js"},{url:"libs/daterangepicker/1.1.0/daterangepicker.min.js"},{url:"libs/sugar/1.3.7/sugar.min.js"},{url:"libs/raphael/2.1.0/raphael-min.js"}).then(function(){basket.require({url:"libs/g-raphael/0.5.1/g.raphael-min.js"},{url:"libs/g-raphael/0.5.1/g.pie-min.js"}).then(function(){})}),angular.module("WebPaige").value("$config",{title:"TeamUp",version:"0.1.0",lang:"nl",fullscreen:!0,demo_users:!1,profile:{meta:profile.meta,title:profile.title,logos:{login:"profiles/"+profile.meta+"/img/login_logo.png",app:""},background:"profiles/"+profile.meta+"/img/login_bg.jpg",p2000:profile.p2000,mobileApp:profile.mobileApp},statesall:{"com.ask-cs.State.Available":{className:"state-available",label:"Beschikbaar",color:"#4f824f",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarNoord":{className:"state-available-north",label:"Beschikbaar voor Noord",color:"#000",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarZuid":{className:"state-available-south",label:"Beschikbaar voor Zuid",color:"#e08a0c",type:"Beschikbaar"},"com.ask-cs.State.Unavailable":{className:"state-unavailable",label:"Niet Beschikbaar",color:"#a93232",type:"Niet Beschikbaar"},"com.ask-cs.State.KNRM.SchipperVanDienst":{className:"state-schipper-service",label:"Schipper van Dienst",color:"#e0c100",type:"Beschikbaar"},"com.ask-cs.State.Unreached":{className:"state-unreached",label:"Niet Bereikt",color:"#65619b",type:"Niet Beschikbaar"}},host:profile.host(),namespace:profile.ns(),formats:{date:"dd-MM-yyyy",time:"HH:mm",datetime:"dd-MM-yyyy HH:mm",datetimefull:"dd-MM-yyyy HH:mm"},roles:profile.roles,mfunctions:profile.mfunctions,stateIcons:profile.stateIcons,stateColors:profile.stateColors,noImgURL:profile.noImgURL,timeline:{options:{axisOnTop:!0,width:"100%",height:"auto",selectable:!0,editable:!0,style:"box",groupsWidth:"200px",eventMarginAxis:0,showCustomTime:!0,groupsChangeable:!1,showNavigation:!1,intervalMin:36e5},config:{zoom:"0.4",bar:!1,layouts:profile.timeline.config.layouts,wishes:!1,legenda:{},legendarer:!1,states:{},divisions:profile.divisions,densities:{less:"#a0a0a0",even:"#ba6a24",one:"#415e6b",two:"#3d5865",three:"#344c58",four:"#2f4550",five:"#2c424c",six:"#253943",more:"#486877"}}},pie:{colors:["#415e6b","#ba6a24","#a0a0a0"]},defaults:{settingsWebPaige:{user:{language:"nl"},app:{widgets:{groups:{}}}}},cookie:{expiry:30,path:"/"},init:function(){var a=this;angular.forEach(profile.states,function(b){a.timeline.config.states[b]=a.statesall[b]})},countries:[{id:44,label:"United Kingdom (44)"},{id:32,label:"Belgium (32)"},{id:33,label:"France (33)"},{id:49,label:"Germany (49)"},{id:31,label:"Netherlands (31)"},{id:90,label:"Turkey (90)"}],regions:{31:[{id:297,label:"Aalsmeer (297)"},{id:72,label:"Alkmaar (72)"},{id:546,label:"Almelo (546)"},{id:36,label:"Almere (36)"},{id:172,label:"Alphen A/D Rijn (172)"},{id:33,label:"Amersfoort (33)"},{id:20,label:"Amsterdam (20)"},{id:55,label:"Apeldoorn (55)"},{id:26,label:"Arnhem (26)"},{id:10,label:"Rotterdam (10)"}],90:[{id:1,label:"Turkey 1"},{id:2,label:"Turkey 2"}],44:[{id:1,label:"United Kingdom 1"},{id:2,label:"United Kingdom 2"}],49:[{id:1,label:"Germany 1"},{id:2,label:"Germany 2"}],33:[{id:1,label:"France 1"},{id:2,label:"France 2"}],32:[{id:1,label:"Belgium 1"},{id:2,label:"Belgium 2"}]},packages:{1:{id:1,label:"Local Numbers",prices:{monthly:{normal:5,premium:15},yearly:{normal:50,premium:150}}},2:{id:2,label:"Virtual Numbers",prices:{monthly:{normal:10,premium:30},yearly:{normal:100,premium:300}}}},packages__:[{id:1,label:"Local Numbers",prices:{monthly:{normal:5,premium:15},yearly:{normal:50,premium:150}}},{id:2,label:"Virtual Numbers",prices:{monthly:{normal:10,premium:30},yearly:{normal:100,premium:300}}}],virtuals:[{id:1,label:"Personal assistant services (84-87)"},{id:2,label:"VPN (82)"},{id:3,label:"Elektronisch communicatie (85 - 91)"},{id:4,label:"Company numbers (88)"}],ranges:{1:[84,85,86,87],2:[82],3:[85,86,87,88,89,90,91],4:[88]},premiums:[{"package":1,country:31,region:10,number:2222222}]}),angular.module("WebPaige").config(["$locationProvider","$routeProvider","$httpProvider",function(a,b){b.when("/login",{templateUrl:"dist/views/login.html",controller:"login"}).when("/forgotpass",{templateUrl:"dist/views/forgotpass.html",controller:"forgotpass"}).when("/register",{templateUrl:"dist/views/register.html",controller:"register"}).when("/logout",{templateUrl:"dist/views/logout.html",controller:"logout"}).when("/team",{templateUrl:"dist/views/teams.html",controller:"teamCtrl",resolve:{data:["Teams","$route",function(a,b){return b.current.params.local&&"true"==b.current.params.local?a.queryLocal():a.query(!1,b.current.params)}]},reloadOnSearch:!1}).when("/client",{templateUrl:"dist/views/clients.html",controller:"clientCtrl",resolve:{data:["Clients","$route",function(a,b){return b.current.params.local&&"true"==b.current.params.local?a.queryLocal():a.query(!1,b.current.params)}]},reloadOnSearch:!1}).when("/clientProfile/:clientId",{templateUrl:"dist/views/clients.html",controller:"clientCtrl",resolve:{data:["$rootScope","$route","$location","Clients",function(a,b){var c={clientId:b.current.params.clientId};return c}]},reloadOnSearch:!1}).when("/manage",{templateUrl:"dist/views/manage.html",controller:"manageCtrl",resolve:{data:["Clients","Teams","$location",function(a,b,c){var d={};if(c.hash()&&"reload"==c.hash()){var e=b.query(),f=a.query();d={t:e,cg:f}}else d.local=!0;return d}]},reloadOnSearch:!1}).when("/planboard",{templateUrl:"dist/views/planboard.html",controller:"planboard",reloadOnSearch:!1}).when("/messages",{templateUrl:"dist/views/messages.html",controller:"messages",reloadOnSearch:!1}).when("/profile/:userId",{templateUrl:"dist/views/profile.html",controller:"profileCtrl",resolve:{data:["$rootScope","Profile","$route","$location","Dater",function(a,b,c){return b.get(c.current.params.userId,!1)}]},reloadOnSearch:!1}).when("/profile",{templateUrl:"dist/views/profile.html",controller:"profileCtrl",resolve:{data:["$rootScope","$route","$location",function(a,b,c){b.current.params.userId&&c.hash()||c.path("/profile/"+a.app.resources.uuid).hash("profile")}]}}).otherwise({redirectTo:"/login"})}]),angular.module("WebPaige").run(["$rootScope","$location","$timeout","Session","Storage","$config","$window","Teams","Dater",function(a,b,c,d,e,f,g,h,i){a.config=f,a.config.init(),a.browser=$.browser,angular.extend(a.browser,{screen:g.screen}),a.browser.ios?angular.extend(a.browser,{landscape:90==Math.abs(g.orientation)?!0:!1,portrait:90!=Math.abs(g.orientation)?!0:!1}):angular.extend(a.browser,{landscape:90!=Math.abs(g.orientation)?!0:!1,portrait:90==Math.abs(g.orientation)?!0:!1}),g.onresize=function(){a.browser.screen=g.screen},g.onorientationchange=function(){a.$apply(function(){a.browser.ios?angular.extend(a.browser,{landscape:90==Math.abs(g.orientation)?!0:!1,portrait:90!=Math.abs(g.orientation)?!0:!1}):angular.extend(a.browser,{landscape:90!=Math.abs(g.orientation)?!0:!1,portrait:90==Math.abs(g.orientation)?!0:!1})})},a.changeLanguage=function(b){a.ui=ui[b]},a.ui=ui[a.config.lang],e.get("periods")&&null!=e.get("periods")||i.registerPeriods(),a.app=a.app||{},a.app.resources=angular.fromJson(e.get("resources")),a.statusBar={init:function(){a.loading={status:!1,message:"Loading.."}},display:function(b){a.loading={status:!0,message:b}},off:function(){a.loading.status=!1}},a.statusBar.init(),a.notification={status:!1,type:"",message:""},a.notifier={init:function(b,c,d){a.notification.status=!0,a.browser.mobile&&1==b?g.alert(d):a.notification={status:b,type:c,message:d}},success:function(a,b){this.init(!0,"alert-success",a),b||this.destroy()},error:function(a,b){this.init(!0,"alert-danger",a),b||this.destroy()},destroy:function(){setTimeout(function(){a.notification.status=!1},5e3)}},a.notifier.init(!1,"",""),a.nav=function(c){if("/manage"!=b.path()||!a.checkDataChangedInManage())switch(c){case"team":b.path("/team").search({local:"true"}).hash("team");break;case"client":b.path("/client").search({local:"true"}).hash("client");break;case"planboard":b.path("/planboard").search({local:"true"}).hash("teams");break;case"profile":b.path("/profile").search({local:"true"}).hash("");break;case"logout":b.path("/logout");break;default:console.log("scope nav : "+c)}},a.checkDataChangedInManage=function(){var c={};if("teamClients"==b.hash()){var d=a.$$childTail.$$childTail.getData.teamClients();c=a.$$childTail.getChangesFromTeamClients(d)}else if("teams"==b.hash()){var e=a.$$childTail.connections.teams,f=a.$$childTail.$$childTail.getData.teams();c=a.$$childTail.getChanges(e,f)}else if("clients"==b.hash()){var g=a.$$childTail.connections.clients,h=a.$$childTail.$$childTail.getData.clients();c=a.$$childTail.getChanges(g,h)}return angular.equals({},c)?(console.log("no changes ! "),!1):confirm(a.ui.teamup.managePanelchangePrompt)?void 0:!0},a.$on("$routeChangeStart",function(){function c(){a.loaderIcons={general:!1,teams:!1,clients:!1,messages:!1,manage:!1,profile:!1,settings:!1}}switch(c(),b.path()){case"/team":a.loaderIcons.team=!0,a.location="team";break;case"/client":a.loaderIcons.client=!0,a.location="cilent";break;case"/messages":a.loaderIcons.messages=!0,a.location="messages";break;case"/manage":a.loaderIcons.messages=!0,a.location="manage";break;case"/logout":a.location="logout";var f=angular.fromJson(e.get("logindata"));e.clearAll(),f.remember&&e.add("logindata",angular.toJson({username:f.username,password:f.password,remember:f.remember}));break;default:b.path().match(/profile/)?(a.loaderIcons.profile=!0,a.location="profile"):a.loaderIcons.general=!0}switch(d.check()||b.path("/login"),a.loadingBig=!0,a.statusBar.display("Loading.."),b.path()){case"/team":a.location="team";break;case"/client":a.location="client";break;case"/messages":a.location="messages";break;case"/manage":a.location="manage";
break;case"/settings":a.location="settings";break;default:b.path().match(/profile/)&&(a.location="profile")}a.location=b.path().substring(1),$("div[ng-view]").hide()}),a.$on("$routeChangeSuccess",function(){a.newLocation=b.path(),a.loadingBig=!1,a.statusBar.off(),$("div[ng-view]").show()}),a.$on("$routeChangeError",function(b,c,d,e){a.notifier.error(e)}),a.fixStyles=function(){var a=$(".tabs-left .nav-tabs").height();$.each($(".tab-content").children(),function(){var b=($(this),$(this).attr("id")),c=$(".tabs-left .tab-content #"+b).height();a>c&&$(".tabs-left .tab-content #"+b).css({height:$(".tabs-left .nav-tabs").height()+6})}),($.os.mac||$.os.linux)&&$(".nav-tabs-app li a span").css({paddingTop:"10px",marginBottom:"0px"})},a.fullScreen=function(){screenfull.toggle($("html")[0])},$.os.windows&&$("#loading p").css({paddingTop:"130px"}),a.getTeamMemberById=function(a){var b,c=angular.fromJson(e.get("Teams"));return angular.forEach(c,function(c){var d=angular.fromJson(e.get(c.uuid));angular.forEach(d,function(c){return c.uuid==a?(b=c,void 0):void 0})}),"undefined"==typeof b&&(b={uuid:a,firstName:a,lastName:""}),b},a.getClientByID=function(a){var b,c=angular.fromJson(e.get("clients"));if(angular.forEach(c,function(c){return a==c.uuid?(b=c,void 0):void 0}),null==b){var d=angular.fromJson(e.get("ClientGroups"));angular.forEach(d,function(c){var d=angular.fromJson(e.get(c.id));angular.forEach(d,function(c){return(c.uuid=a)?(b=c,void 0):void 0})})}return b},a.getClientsByTeam=function(a){var b=[],c=[];return angular.forEach(a,function(a){var d=angular.fromJson(e.get("teamGroup_"+a));angular.forEach(d,function(a){var d=angular.fromJson(e.get(a.id));angular.forEach(d,function(a){if(-1==c.indexOf(a.uuid)){c.add(a.uuid);var d={uuid:a.uuid,name:a.firstName+" "+a.lastName};b.add(d)}})})}),b},a.getMembersByClient=function(a){var b=[],c=[],d=angular.fromJson(e.get("Teams"));return angular.forEach(d,function(d){var f=angular.fromJson(e.get("teamGroup_"+d.uuid));angular.forEach(f,function(f){if(a==f.id){var g=angular.fromJson(e.get(d.uuid));angular.forEach(g,function(a){if(-1==c.indexOf(a.uuid)){c.add(a.uuid);var d={uuid:a.uuid,name:a.firstName+" "+a.lastName};b.add(d)}})}})}),b},a.getAvatarURL=function(a){var b=angular.fromJson(e.get("avatarUrls")),c="";return angular.forEach(b,function(b){b.userId==a&&(c=b.url)}),c}}]),angular.module("WebPaige.Modals.User",["ngResource"]).factory("User",["$resource","$config","$q","$location","Storage","$rootScope",function(a,b,c,d,e){var f=a(),g=a(b.host+b.namespace+"/login",{},{process:{method:"GET",params:{uuid:"",pass:""}}}),h=a(b.host+"logout",{},{process:{method:"GET",params:{}}}),i=a(b.host+b.namespace+"/team/member",{},{get:{method:"GET",params:{}}}),j=a(b.host+"/passwordReset",{},{password:{method:"GET",params:{uuid:"",path:""}}});return f.prototype.password=function(a){var b=c.defer();return j.password({uuid:a.toLowerCase(),path:d.absUrl()},function(a){angular.equals(a,[])?b.resolve("ok"):b.resolve(a)},function(a){b.resolve(a)}),b.promise},f.prototype.login=function(a,b){var d=c.defer();return g.process({uuid:a,pass:b},function(a){angular.equals(a,[])?d.reject("Something went wrong with login!"):d.resolve(a)},function(a){d.resolve(a)}),d.promise},f.prototype.changePass=function(){var a=c.defer();return changePassword.get(function(b){a.resolve(b)},function(b){a.resolve(b)}),a.promise},f.prototype.logout=function(){var a=c.defer();return h.process(null,function(b){a.resolve(b)},function(b){a.resolve({error:b})}),a.promise},f.prototype.memberInfo=function(){var a=c.defer();return i.get(null,function(b){angular.equals(b,[])?a.reject("User has no resources!"):(e.add("resources",angular.toJson(b)),a.resolve(b))},function(b){a.resolve({error:b})}),a.promise},new f}]),angular.module("WebPaige.Modals.Profile",["ngResource"]).factory("Profile",["$rootScope","$config","$resource","$q","Storage","Teams","MD5",function(a,b,c,d,e,f,g){var h=c(b.host+b.namespace+"/team/member/:memberId/",{},{get:{method:"GET"},save:{method:"PUT"},role:{method:"PUT",params:{section:"role"}}}),i=c(b.host+b.namespace+"/team/:teamId/member/:memberId/",{},{save:{method:"PUT"}}),j=c(b.host+b.namespace+"/team/member/:memberId/photourl",{},{getURL:{method:"GET",isArray:!1}}),k=c(b.host+"/register",{direct:"true",module:"default"},{profile:{method:"GET",params:{uuid:"",pass:"",name:"",phone:""}}}),l=c(b.host+"/resources",{},{get:{method:"GET",params:{}},save:{method:"POST",params:{}}});return h.prototype.register=function(a){var b=d.defer();return k.profile({uuid:a.username,pass:g(a.password),name:a.name,phone:a.PhoneAddress},function(c){h.prototype.role(a.username,a.role.id).then(function(e){h.prototype.save(a.username,{EmailAddress:a.EmailAddress,PostAddress:a.PostAddress,PostZip:a.PostZip,PostCity:a.PostCity}).then(function(f){var g=[];angular.forEach(a.groups,function(b){g.push(Groups.addMember({id:a.username,group:b}))}),d.all(g).then(function(a){b.resolve({registered:c,roled:e,resourced:f,grouped:a})})})})},function(a){b.resolve({error:a})}),b.promise},h.prototype.role=function(a,b){var c=d.defer();return h.role({id:a},b,function(a){c.resolve(a)},function(a){c.resolve({error:a})}),c.promise},h.prototype.changePassword=function(a){var b=d.defer();return l.save(null,{askPass:g(a.new1)},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.get=function(b,c){var f=d.defer();return h.get({memberId:b},function(d){b==a.app.resources.uuid&&(a.app.resources=d),c&&e.add("resources",angular.toJson(d)),f.resolve({resources:d})},function(a){console.log(a)}),f.promise},h.prototype.getWithSlots=function(a,b,c){var e=d.defer();return h.prototype.get(a,b).then(function(b){Slots.user({user:a,start:c.start,end:c.end}).then(function(a){e.resolve(angular.extend(b,{slots:a,synced:(new Date).getTime(),periods:{start:1e3*c.start,end:1e3*c.end}}))})}),e.promise},h.prototype.getSlots=function(a,b){var c=d.defer();return Slots.user({user:a,start:b.start/1e3,end:b.end/1e3}).then(function(a){c.resolve({slots:a,synced:(new Date).getTime(),periods:{start:b.start,end:b.end}})}),c.promise},h.prototype.local=function(){return angular.fromJson(e.get("resources"))},h.prototype.save=function(a,b){var c=d.defer();return i.save({teamId:b.teamUuids[0],memberId:a},b,function(a){c.resolve(a)},function(a){c.resolve({error:a})}),c.promise},h.prototype.loadUploadURL=function(a){var b=d.defer();return j.getURL({memberId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.createSettings_=function(b){var c=d.defer();return h.prototype.get(b,!1).then(function(b){void 0==b.settingsWebPaige||null==b.settingsWebPaige?h.save({id:b.resources.uuid},angular.toJson({settingsWebPaige:a.config.defaults.settingsWebPaige}),function(a){c.resolve({status:"modified",resources:a})},function(a){c.resolve({error:a})}):c.resolve({status:"full",resources:b})}),c.promise},new h}]),angular.module("WebPaige.Modals.Core",["ngResource"]).factory("Core",["$rootScope","$resource","$config","$q","$http",function(){}]),angular.module("WebPaige.Modals.Teams",["ngResource"]).factory("Teams",["$resource","$config","$q","Storage","$rootScope",function(a,b,c,d,e){var f=a(b.host+b.namespace+"/team/",{},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{id:""}},edit:{method:"PUT",params:{id:""}},remove:{method:"DELETE",params:{id:""}}}),g=a(b.host+b.namespace+"/team/status/:teamId/",{},{query:{method:"GET",params:{},isArray:!0}}),h=a(b.host+b.namespace+"/team/:teamId/",{},{edit:{method:"PUT"},del:{method:"DELETE"}}),i=a(b.host+b.namespace+"/team/:teamId/member",{},{save:{method:"POST"}}),j=a(b.host+b.namespace+"/team/:teamId/removeMember",{},{remove:{method:"PUT"}}),k=a(b.host+b.namespace+"/team/:teamId/clientGroups",{},{query:{method:"GET",params:{},isArray:!0},add:{method:"POST"}}),l=a(b.host+b.namespace+"/team/:teamId/unAssignClientGroups",{},{unssign:{method:"PUT"}}),m=a(b.host+b.namespace+"/team/:teamId/updateClientGroups",{},{update:{method:"PUT"}}),n=a(b.host+b.namespace+"/team/:teamId/updateMembers",{},{update:{method:"PUT"}}),o=a(b.host+b.namespace+"/team/member",{},{save:{method:"POST"}}),p=a(b.host+b.namespace+"/team/:teamId/tasks",{},{query:{method:"GET",params:{from:"",to:""},isArray:!0}}),q=a(b.host+b.namespace+"/team/members",{},{query:{method:"GET",isArray:!0}}),r=a(b.host+b.namespace+"/team/member/:memberId",{},{remove:{method:"DELETE"}});return f.prototype.addMember=function(a,b){var d=c.defer();return i.save({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.delMember=function(a,b){var d=c.defer();return j.remove({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.addGroup=function(a,b){var d=c.defer();return k.add({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.delGroup=function(a,b){var d=c.defer();return l.unssign({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.updateGroup=function(a,b){var d=c.defer();return m.update({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.updateMemberRelation=function(a,b){var d=c.defer();return n.update({teamId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},f.prototype.query=function(a,b){var e=c.defer();return f.query(function(g){if(d.add("Teams",angular.toJson(g)),a)e.resolve(g);else{var h=[];angular.forEach(g,function(a){b.uuid?b.uuid==a.uuid&&h.push(f.prototype.get(a.uuid)):h.push(f.prototype.get(a.uuid))}),c.all(h).then(function(a){var c={};c.members={},angular.forEach(g,function(e){c.teams=g,c.members[e.uuid]=[],angular.forEach(a,function(a){b.uuid?c.members[e.uuid]=a.id==e.uuid&&b.uuid==e.uuid?a.data:angular.fromJson(d.get(e.uuid)):a.id==e.uuid&&(c.members[e.uuid]=a.data)})}),e.resolve(c)})}},function(a){console.log("Error"+a),e.resolve({error:a})}),e.promise},f.prototype.queryLocal=function(){var a=c.defer(),b=angular.fromJson(d.get("Teams")),e={};return e.teams=b,e.members={},angular.forEach(b,function(a){var b=angular.fromJson(d.get(a.uuid));e.members[a.uuid]=b}),a.resolve(e),a.promise},f.prototype.queryStatus=function(){var a=c.defer();g.query({},function(){a.resolve({id:id,data:returned})},function(b){a.resolve({error:b})})},f.prototype.get=function(a){var b=c.defer();return g.query({teamId:a},function(c){var e;e=4==c.length&&"n"==c[0][0]&&"u"==c[1][0]?[]:c,d.add(a,angular.toJson(e)),b.resolve({id:a,data:e})},function(a){b.resolve({error:a})}),b.promise},f.prototype.save=function(a){var b=c.defer();return f.save({id:e.app.resources.uuid},a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},f.prototype.saveMember=function(a){var b=c.defer();return o.save({},a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},f.prototype.edit=function(a){var b=c.defer();return a.uuid&&h.edit({teamId:a.uuid},a,function(a){b.resolve(a)}),b.promise},f.prototype.loadImg=function(b){var d=a(b,{},{get:{method:"GET"}}),e=c.defer();return d.get(function(a){e.resolve(a)},function(a){e.resolve(a)}),e.promise},f.prototype.loadTeamCallinNumber=function(d){var e=a(b.host+b.namespace+"/team/:teamId/phone",{},{get:{method:"GET"}}),f=c.defer();return e.get({teamId:d},function(a){f.resolve(a)},function(a){f.resolve({error:a})}),f.promise},f.prototype.queryClientGroups=function(a){var b=c.defer(),d=[];return angular.forEach(a,function(a){d.push(f.prototype.getGroup(a.uuid))}),c.all(d).then(function(c){var d={};d.groups={},angular.forEach(a,function(b){d.teams=a,d.groups[b.uuid]=[],angular.forEach(c,function(a){d.groups[b.uuid]=a.data})}),b.resolve(d)}),b.promise},f.prototype.getGroup=function(a){var b=c.defer();return k.query({teamId:a},function(c){var e;e=4==c.length&&"n"==c[0][0]&&"u"==c[1][0]?[]:c,d.add("teamGroup_"+a,angular.toJson(e)),b.resolve({id:a,data:e})},function(a){b.resolve({error:a})}),b.promise},f.prototype.manage=function(a){var b=c.defer(),d=[];return angular.forEach(a,function(a,b){a.a.length>0&&0==a.r.length&&d.push(f.prototype.addMember(b,{ids:a.a})),a.r.length>0&&0==a.a.length&&d.push(f.prototype.delMember(b,{ids:a.r})),a.a.length>0&&a.r.length>0&&d.push(f.prototype.updateMemberRelation(b,{remove:a.r,add:a.a}))}),c.all(d).then(function(){var d=[],e={};angular.forEach(a,function(a,b){d.push(f.prototype.get(b))}),c.all(d).then(function(){b.resolve(e)})}),b.promise},f.prototype.manageGroups=function(a){var b=c.defer(),d=[];return angular.forEach(a,function(a,b){a.a.length>0&&0==a.r.length&&d.push(f.prototype.addGroup(b,{ids:a.a})),a.r.length>0&&0==a.a.length&&d.push(f.prototype.delGroup(b,{ids:a.r})),a.a.length>0&&a.r.length>0&&d.push(f.prototype.updateGroup(b,{remove:a.r,add:a.a}))}),c.all(d).then(function(d){var e=d,g=[];angular.forEach(a,function(a,b){g.push(f.prototype.getGroup(b))}),c.all(g).then(function(){b.resolve(e)})}),b.promise},f.prototype.getTeamTasks=function(a,b,d){var e=c.defer();return p.query({teamId:a,from:b,to:d},function(a){e.resolve(a)},function(a){e.resolve({error:a})}),e.promise},f.prototype.queryMembersNotInTeams=function(){var a=c.defer();return q.query({},function(b){d.add("members",angular.toJson(b)),a.resolve(b)},function(b){a.resolve({error:b})}),a.promise},f.prototype.deleteTeam=function(a){var b=c.defer();return h.delete({teamId:a},function(a){b.resolve(a.result)},function(a){b.resolve({error:a})}),b.promise},f.prototype.deleteMember=function(a){var b=c.defer();return r.remove({memberId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},new f}]),angular.module("WebPaige.Modals.Clients",["ngResource"]).factory("Clients",["$resource","$config","$q","Storage","$rootScope",function(a,b,c,d){var e=a(b.host+b.namespace+"/client/clientGroups/",{},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{id:""}},edit:{method:"PUT",params:{id:""}},remove:{method:"DELETE",params:{id:""}}}),f=a(b.host+b.namespace+"/client/clientGroup/:clientGroupId/clients/",{},{get:{method:"GET",params:{},isArray:!0},save:{method:"POST"},remove:{method:"DELETE"}}),g=a(b.host+b.namespace+"/clientGroup/:clientGroupId",{},{save:{method:"POST"},edit:{method:"PUT"},del:{method:"DELETE"}}),h=a(b.host+b.namespace+"/client/:clientId",{},{save:{method:"POST"},edit:{method:"PUT"},del:{method:"DELETE"}}),i=a(b.host+b.namespace+"/client/clients",{},{query:{method:"GET",params:{},isArray:!0}}),j=a(b.host+b.namespace+"/clients/:clientId/reports",{},{query:{method:"GET",params:{},isArray:!0}}),k=a(b.host+b.namespace+"/client/clientGroup/:clientGroupId/removeClients/",{},{remove:{method:"PUT"}}),l=a(b.host+b.namespace+"/clientGroup/:clientGroupId/reports",{},{query:{method:"GET",params:{},isArray:!0}}),m=a(b.host+b.namespace+"/clientGroup/:clientGroupId/tasks",{},{query:{method:"GET",params:{from:"",to:""},isArray:!0}}),n=a(b.host+b.namespace+"/clients/:clientId/reports",{},{save:{method:"POST"},remove:{method:"DELETE",params:{reportId:""}}}),o=a(b.host+b.namespace+"/client/:clientId/photourl",{},{getURL:{method:"GET",isArray:!1}});e.prototype.query=function(a,b){var f=c.defer();return e.query(function(g){if(d.add("ClientGroups",angular.toJson(g)),a)f.resolve(g);else{var h=[];angular.forEach(g,function(a){b.uuid?b.uuid==a.id&&h.push(e.prototype.get(a.id)):h.push(e.prototype.get(a.id))}),c.all(h).then(function(a){var c={};c.clients={},angular.forEach(g,function(e){c.clientGroups=g,c.clients[e.id]=[],angular.forEach(a,function(a){b.uuid?c.clients[e.id]=a.id==e.id&&b.uuid==e.id?a.data:angular.fromJson(d.get(e.id)):a.id==e.id&&(c.clients[e.id]=a.data)})}),"undefined"==typeof c.clientGroups&&(c.clientGroups={}),f.resolve(c)})}},function(a){console.log("Error"+a),f.resolve({error:a})}),f.promise},e.prototype.get=function(a){var b=c.defer();return f.get({clientGroupId:a},function(c){var e;e=4==c.length&&"n"==c[0][0]&&"u"==c[1][0]?[]:c,d.add(a,angular.toJson(e)),b.resolve({id:a,data:e})},function(a){b.resolve({error:a})}),b.promise},e.prototype.saveGroup=function(a){var b=c.defer();return g.save(a,function(a){d.add(a.id,angular.toJson(a)),b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},e.prototype.save=function(a){var b=c.defer();return h.save(a,function(a){d.add(a.id,angular.toJson(a)),b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},e.prototype.edit=function(a){var b=c.defer();return a.id&&g.edit({clientGroupId:a.id},a,function(a){b.resolve(a)}),b.promise},e.prototype.updateClient=function(a){var b=c.defer();return h.edit({clientId:a.uuid},a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},e.prototype.addClient=function(a,b){var d=c.defer();return f.save({clientGroupId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise},e.prototype.delClient=function(a,b){var d=c.defer();return k.remove({clientGroupId:a},b,function(a){d.resolve(a)},function(a){d.resolve({error:a})}),d.promise};var p=function(a){var b,c=angular.fromJson(d.get("ClientGroups"));return angular.forEach(c,function(c){var e=angular.fromJson(d.get(c.id));angular.forEach(e,function(c){c.uuid==a&&(b=c)})}),b};return e.prototype.manage=function(a){var b=c.defer(),d=[];return angular.forEach(a,function(a,b){a.a.length>0&&d.push(e.prototype.addClient(b,{ids:a.a})),a.r.length>0&&d.push(e.prototype.delClient(b,{ids:a.r}))}),c.all(d).then(function(){var d=[],f={},g=[];angular.forEach(a,function(a,b){g.add(b),a.a.length>0&&angular.forEach(a.a,function(a){var b=p(a);"undefined"!=typeof b&&-1==g.indexOf(b.clientGroupUuid)&&(g.add(b.clientGroupUuid),d.push(e.prototype.get(b.clientGroupUuid)))}),d.push(e.prototype.get(b))}),c.all(d).then(function(){b.resolve(f)})}),b.promise},e.prototype.queryAll=function(){var a=c.defer();return i.query(function(b){d.add("clients",angular.toJson(b)),a.resolve(b)},function(b){a.resolve({error:b})}),a.promise},e.prototype.queryReports=function(a){var b=c.defer();return j.query({clientId:a},function(c){d.add("reports_"+a,angular.toJson(c)),b.resolve(c)},function(a){b.resolve({error:a})}),b.promise},e.prototype.loadImg=function(b){var d=a(b,{},{get:{method:"GET"}}),e=c.defer();return d.get(function(a){e.resolve(a)},function(a){e.resolve(a)}),e.promise},e.prototype.queryLocal=function(){var a=c.defer(),b=angular.fromJson(d.get("ClientGroups")),e={};return e.clientGroups=b,e.clients={},angular.forEach(b,function(a){var b=angular.fromJson(d.get(a.id));e.clients[a.id]=b}),a.resolve(e),a.promise},e.prototype.queryGroupReports=function(a){var b=c.defer();return l.query({clientGroupId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},e.prototype.getClientTasks=function(a,b,d){var e=c.defer();return m.query({clientGroupId:a,from:b,to:d},function(a){e.resolve(a)},function(a){e.resolve({error:a})}),e.promise},e.prototype.deleteClientGroup=function(a){var b=c.defer();return g.del({clientGroupId:a},function(a){var c=angular.fromJson(a);b.resolve(c)},function(a){b.resolve({error:a})}),b.promise},e.prototype.deleteClient=function(a){var b=c.defer();return h.del({clientId:a},function(a){var c=angular.fromJson(a);b.resolve(c)},function(a){b.resolve({error:a})}),b.promise},e.prototype.saveReport=function(a,b){var d=c.defer();return n.save({clientId:a},b,function(a){var b=angular.fromJson(a);d.resolve(b)},function(a){d.resolve({error:a})}),d.promise},e.prototype.removeReport=function(a,b){var d=c.defer();return n.remove({clientId:a,reportId:b},function(a){var b=angular.fromJson(a);d.resolve(b)},function(a){d.resolve({error:a})}),d.promise},e.prototype.loadUploadURL=function(a){var b=c.defer();return o.getURL({clientId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},new e}]),angular.module("WebPaige.Modals.Settings",["ngResource"]).factory("Settings",["$rootScope","$config","$resource","$q","Storage","Profile",function(a,b,c,d,e,f){var g=c();return g.prototype.get=function(){return angular.fromJson(e.get("resources")).settingsWebPaige||{}},g.prototype.save=function(a,b){var c=d.defer();return f.save(a,{settingsWebPaige:angular.toJson(b)}).then(function(){c.resolve({saved:!0})}),c.promise},new g}]),angular.module("WebPaige.Modals.Messages",["ngResource"]).factory("Messages",["$rootScope","$config","$resource","$q","Storage","$http",function(a,b,c,d){var e=c(b.host+b.namespace+"/team/teamMessage/",{},{query:{method:"GET",params:{action:"",0:"all",status:"READ",limit:50,offset:0},isArray:!0},get:{method:"GET",params:{}},send:{method:"POST"},save:{method:"POST",params:{}},changeState:{method:"POST",params:{action:"changeState"}},remove:{method:"POST",params:{action:"deleteQuestions"}}}),f=c(b.host+b.namespace+"/team/teamMessage/:teamId",{},{query:{method:"GET",params:{},isArray:!0}});return e.prototype.queryTeamMessage=function(a){var b=d.defer();return f.query({teamId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},e.prototype.sendTeamMessage=function(a){var b=d.defer();return e.send(a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},new e}]),angular.module("WebPaige.Modals.Slots",["ngResource"]).factory("Slots",["$rootScope","$config","$resource","$q","Storage","Dater","Sloter",function(a,b,c,d,e,f){function g(a){var b=angular.fromJson(a.content);return{start:new Date(a.start).getTime()/1e3,end:new Date(a.end).getTime()/1e3,recursive:b.recursive,text:b.state,id:b.id}}var h=c(b.host+b.namespace+"/tasks/:taskId",{},{query:{method:"GET",params:{start:"",end:""},isArray:!0},change:{method:"PUT"},save:{method:"POST"},remove:{method:"DELETE"}}),i=c(b.host+"/calc_planning/:id",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0}}),j=c(b.host+"/network/:id/wish",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0},save:{method:"PUT",params:{id:""}}});h.prototype.wishes=function(a){var b=d.defer(),c={id:a.id,start:a.start,end:a.end};return j.query(c,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.setWish=function(a){var b=d.defer(),c={start:a.start,end:a.end,wish:a.wish,recurring:a.recursive};return j.save({id:a.id},c,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.aggs=function(a){var b=d.defer(),c={id:a.id,start:a.start,end:a.end};return void 0!=a.division&&(c.stateGroup=a.division),i.query(c,function(d){var e=Stats.aggs(d);h.prototype.wishes(c).then(function(c){b.resolve({id:a.id,division:a.division,wishes:c,data:d,ratios:e.ratios,durations:e.durations})})},function(a){b.resolve({error:a})}),b.promise},h.prototype.pie=function(a){var c=d.defer(),e=Math.floor(Date.now().getTime()/1e3),g=f.getPeriods(),h=f.current.week(),j={current:{period:g.weeks[h],data:[],shortages:[]},next:{period:g.weeks[h+1],data:[],shortages:[]}},k=j.current.period.last.timeStamp;return i.query({id:a.id,start:j.current.period.first.timeStamp/1e3,end:j.next.period.last.timeStamp/1e3},function(d){var f;if(d.length>1){angular.forEach(d,function(a){e>=a.start&&e<=a.end&&(f=a),k<=1e3*a.start?j.next.data.push(a):k>=1e3*a.start&&j.current.data.push(a)});var g=j.current.data[j.current.data.length-1],h=(j.next.data[0],(1e3*g.end-k)/1e3),i=[];j.current.data[0].start=j.current.period.first.timeStamp/1e3,h>0&&(g.end=k/1e3,j.next.data.unshift({diff:g.diff,start:k/1e3,end:g.end,wish:g.wish})),angular.forEach(j.current.data,function(a){a.end-a.start>0&&i.push(a),a.diff<0&&j.current.shortages.push(a)}),i[0].start=j.current.period.first.timeStamp/1e3,angular.forEach(j.next.data,function(a){a.diff<0&&j.next.shortages.push(a)}),c.resolve({id:a.id,name:a.name,weeks:{current:{data:i,state:f,shortages:j.current.shortages,start:{date:new Date(j.current.period.first.timeStamp).toString(b.formats.date),timeStamp:j.current.period.first.timeStamp},end:{date:new Date(j.current.period.last.timeStamp).toString(b.formats.date),timeStamp:j.current.period.last.timeStamp},ratios:Stats.pies(i)},next:{data:j.next.data,shortages:j.next.shortages,start:{date:new Date(j.next.period.first.timeStamp).toString(b.formats.date),timeStamp:j.next.period.first.timeStamp},end:{date:new Date(j.next.period.last.timeStamp).toString(b.formats.date),timeStamp:j.next.period.last.timeStamp},ratios:Stats.pies(j.next.data)}}})}else{null==d[0].diff&&(d[0].diff=0),null==d[0].wish&&(d[0].wish=0);var l=[{start:j.current.period.first.timeStamp/1e3,end:j.current.period.last.timeStamp/1e3,wish:d[0].wish,diff:d[0].diff}],m=[{start:j.next.period.first.timeStamp/1e3,end:j.next.period.last.timeStamp/1e3,wish:d[0].wish,diff:d[0].diff}];l[0].diff<0&&j.current.shortages.push(l[0]),m[0].diff<0&&j.next.shortages.push(m[0]),c.resolve({id:a.id,name:a.name,weeks:{current:{data:l,state:l,shortages:j.current.shortages,start:{date:new Date(j.current.period.first.timeStamp).toString(b.formats.date),timeStamp:j.current.period.first.timeStamp},end:{date:new Date(j.current.period.last.timeStamp).toString(b.formats.date),timeStamp:j.current.period.last.timeStamp},ratios:Stats.pies(l)},next:{data:m,shortages:j.next.shortages,start:{date:new Date(j.next.period.first.timeStamp).toString(b.formats.date),timeStamp:j.next.period.first.timeStamp},end:{date:new Date(j.next.period.last.timeStamp).toString(b.formats.date),timeStamp:j.next.period.last.timeStamp},ratios:Stats.pies(m)}}})}},function(a){c.resolve({error:a})}),c.promise};var k={init:function(b){a.app.preloader={status:!0,total:b,count:0}},count:function(){a.app.preloader.count=Math.abs(Math.floor(a.app.preloader.count+100/a.app.preloader.total))}};return h.prototype.all=function(a){var b=d.defer(),c=(f.getPeriods(),{user:angular.fromJson(e.get("resources")).uuid,start:a.stamps.start/1e3,end:a.stamps.end/1e3});return h.query(c,function(f){if(a.layouts.group){var g={id:a.groupId,start:c.start,end:c.end,month:a.month};"all"!=a.division&&(g.division=a.division),h.prototype.aggs(g).then(function(g){if(a.layouts.members){var i=angular.fromJson(e.get(a.groupId)),j=[];k.init(i.length),angular.forEach(i,function(a){j.push(h.prototype.user({user:a.uuid,start:c.start,end:c.end,type:"both"}))}),d.all(j).then(function(c){b.resolve({user:f,groupId:a.groupId,aggs:g,members:c,synced:(new Date).getTime(),periods:{start:a.stamps.start,end:a.stamps.end}})})}else b.resolve({user:f,groupId:a.groupId,aggs:g,synced:(new Date).getTime(),periods:{start:a.stamps.start,end:a.stamps.end}})})}else b.resolve({user:f,synced:(new Date).getTime(),periods:{start:a.stamps.start,end:a.stamps.end}})},function(a){b.resolve({error:a})}),b.promise},h.prototype.user=function(a){var b=d.defer();return h.query(a,function(c){k.count(),b.resolve({id:a.user,data:c,stats:Stats.member(c)})},function(a){b.resolve({error:a})}),b.promise},h.prototype.local=function(){return angular.fromJson(e.get("slots"))},h.prototype.add=function(a){var b=d.defer();return h.save(a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.update=function(a){var b=d.defer();return h.change({taskId:a.uuid},a,function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},h.prototype.change=function(a,b){var c=d.defer();return h.change(angular.extend(g(a),{member:b}),function(a){c.resolve(a)},function(a){c.resolve({error:a})}),c.promise},h.prototype.remove=function(a){var b=d.defer();return h.remove({taskId:a},function(a){b.resolve(a)},function(a){b.resolve({error:a})}),b.promise},new h}]),angular.module("WebPaige.Directives",["ngResource"]).directive("chosen",function(){var a=function(a,b){a.$watch("receviersList",function(){b.trigger("liszt:updated")}),a.$watch("message.receviers",function(){$(b[0]).trigger("liszt:updated")}),b.chosen()};return{restrict:"A",link:a}}).directive("uploader",[function(){return{restrict:"E",scope:{action:"@"},controller:["$scope","$rootScope","Storage",function(a,b,c){a.progress=0,a.avatar="",a.uploadLabel=b.ui.profile.click2upload;var d=angular.fromJson(c.cookie.get("session"));return d?(a.sessionId=d.id,a.sendFile=function(b){var c=$(b).parents("form");return""==$(b).val()?!1:(c.attr("action",a.action),a.$apply(function(){a.progress=0}),c.ajaxSubmit({type:"POST",headers:{"X-SESSION_ID":a.sessionId},uploadProgress:function(b,c,d,e){a.$apply(function(){a.progress=e})},error:function(a,b,d){c.removeAttr("action"),console.log("response : ",d)},success:function(){var d=$(b).val().split("\\"),e=d[d.length-1];c.removeAttr("action"),a.$apply(function(){a.avatar=e})}}),void 0)},void 0):(b.notifier.success(b.ui.profile.sessionExpired),!1)}],link:function(a,b){b.find(".fake-uploader").click(function(){b.find('input[type="file"]').click()})},replace:!1,templateUrl:"js/views/uploader.html"}}]).directive("profile",[function(){return{restrict:"E",scope:{memberId:"@"},controller:["$scope","$rootScope","Storage",function(a){console.log(a.memberId),a.loadMember=function(){}}],link:function(a,b,c){console.log(c.memberId)},replace:!1,templateUrl:"js/views/profileTemplate.html"}}]).directive("ngenter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngenter)}),b.preventDefault())})}}),angular.module("$strap.config",[]).value("$strap.config",{}),angular.module("$strap.filters",["$strap.config"]),angular.module("$strap.directives",["$strap.config"]),angular.module("$strap",["$strap.filters","$strap.directives","$strap.config"]),angular.module("$strap.directives").directive("bsAlert",["$parse","$timeout","$compile",function(a,b,c){"use strict";return{restrict:"A",link:function(b,d,e){var f=a(e.bsAlert),g=(f.assign,f(b));e.bsAlert?b.$watch(e.bsAlert,function(a,f){g=a,d.html((a.title?"<strong>"+a.title+"</strong>&nbsp;":"")+a.content||""),a.closed&&d.hide(),c(d.contents())(b),(a.type||f.type)&&(f.type&&d.removeClass("alert-"+f.type),a.type&&d.addClass("alert-"+a.type)),(angular.isUndefined(e.closeButton)||"0"!==e.closeButton&&"false"!==e.closeButton)&&d.prepend('<button type="button" class="close" data-dismiss="alert">&times;</button>')},!0):(angular.isUndefined(e.closeButton)||"0"!==e.closeButton&&"false"!==e.closeButton)&&d.prepend('<button type="button" class="close" data-dismiss="alert">&times;</button>'),d.addClass("alert").alert(),d.hasClass("fade")&&(d.removeClass("in"),setTimeout(function(){d.addClass("in")}));var h=e.ngRepeat&&e.ngRepeat.split(" in ").pop();d.on("close",function(a){var c;h?(a.preventDefault(),d.removeClass("in"),c=function(){d.trigger("closed"),b.$parent&&b.$parent.$apply(function(){for(var a=h.split("."),c=b.$parent,d=0;a.length>d;++d)c&&(c=c[a[d]]);c&&c.splice(b.$index,1)})},$.support.transition&&d.hasClass("fade")?d.on($.support.transition.end,c):c()):g&&(a.preventDefault(),d.removeClass("in"),c=function(){d.trigger("closed"),b.$apply(function(){g.closed=!0})},$.support.transition&&d.hasClass("fade")?d.on($.support.transition.end,c):c())})}}}]),angular.module("$strap.directives").directive("bsButton",["$parse","$timeout",function(a){"use strict";return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){if(e){c.parent('[data-toggle="buttons-checkbox"], [data-toggle="buttons-radio"]').length||c.attr("data-toggle","button");var f=!!b.$eval(d.ngModel);f&&c.addClass("active"),b.$watch(d.ngModel,function(a,b){var d=!!a,e=!!b;d!==e?$.fn.button.Constructor.prototype.toggle.call(g):d&&!f&&c.addClass("active")})}c.hasClass("btn")||c.on("click.button.data-api",function(){c.button("toggle")}),c.button();var g=c.data("button");g.toggle=function(){if(!e)return $.fn.button.Constructor.prototype.toggle.call(this);var d=c.parent('[data-toggle="buttons-radio"]');d.length?(c.siblings("[ng-model]").each(function(c,d){a($(d).attr("ng-model")).assign(b,!1)}),b.$digest(),e.$modelValue||(e.$setViewValue(!e.$modelValue),b.$digest())):b.$apply(function(){e.$setViewValue(!e.$modelValue)})}}}}]).directive("bsButtonsCheckbox",["$parse",function(){"use strict";return{restrict:"A",require:"?ngModel",compile:function(a){a.attr("data-toggle","buttons-checkbox").find("a, button").each(function(a,b){$(b).attr("bs-button","")})}}}]).directive("bsButtonsRadio",["$parse",function(){"use strict";
return{restrict:"A",require:"?ngModel",compile:function(a,b){return a.attr("data-toggle","buttons-radio"),b.ngModel||a.find("a, button").each(function(a,b){$(b).attr("bs-button","")}),function(a,b,c,d){d&&(b.find("[value]").button().filter('[value="'+a.$eval(c.ngModel)+'"]').addClass("active"),b.on("click.button.data-api",function(b){a.$apply(function(){d.$setViewValue($(b.target).closest("button").attr("value"))})}),a.$watch(c.ngModel,function(d,e){if(d!==e){var f=b.find('[value="'+a.$eval(c.ngModel)+'"]');f.length&&$.fn.button.Constructor.prototype.toggle.call(f.data("button"))}}))}}}}]),angular.module("$strap.directives").directive("bsButtonSelect",["$parse","$timeout",function(a){"use strict";return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){var f=a(d.bsButtonSelect);f.assign,e&&(c.text(b.$eval(d.ngModel)),b.$watch(d.ngModel,function(a){c.text(a)}));var g,h,i,j;c.bind("click",function(){g=f(b),h=e?b.$eval(d.ngModel):c.text(),i=g.indexOf(h),j=i>g.length-2?g[0]:g[i+1],console.warn(g,j),b.$apply(function(){c.text(j),e&&e.$setViewValue(j)})})}}}]),angular.module("$strap.directives").directive("bsDatepicker",["$timeout",function(){"use strict";var a="ontouchstart"in window&&!window.navigator.userAgent.match(/PhantomJS/i),b={"/":"[\\/]","-":"[-]",".":"[.]",dd:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",d:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",mm:"(?:[0]?[1-9]|[1][012])",m:"(?:[0]?[1-9]|[1][012])",yyyy:"(?:(?:[1]{1}[0-9]{1}[0-9]{1}[0-9]{1})|(?:[2]{1}[0-9]{3}))(?![[0-9]])",yy:"(?:(?:[0-9]{1}[0-9]{1}))(?![[0-9]])"};return{restrict:"A",require:"?ngModel",link:function(c,d,e,f){var g=function(a,c){c||(c={});var d=a,e=b;return angular.forEach(e,function(a,b){d=d.split(b).join(a)}),RegExp("^"+d+"$",["i"])},h=a?"yyyy/mm/dd":g(e.dateFormat||"mm/dd/yyyy");f&&f.$parsers.unshift(function(a){return!a||h.test(a)?(f.$setValidity("date",!0),a):(f.$setValidity("date",!1),void 0)});var i=d.next('[data-toggle="datepicker"]');if(i.length&&i.on("click",function(){a?d.trigger("focus"):d.datepicker("show")}),a&&"text"===d.prop("type"))d.prop("type","date"),d.on("change",function(){c.$apply(function(){f.$setViewValue(d.val())})});else{f&&d.on("changeDate",function(){c.$apply(function(){f.$setViewValue(d.val())})});var j=d.closest(".popover");j&&j.on("hide",function(){var a=d.data("datepicker");a&&(a.picker.remove(),d.data("datepicker",null))}),d.attr("data-toggle","datepicker"),d.datepicker({autoclose:!0,forceParse:e.forceParse||!1,language:e.language||"en"})}}}}]),angular.module("$strap.directives").directive("bsDropdown",["$parse","$compile",function(a,b){"use strict";var c=Array.prototype.slice,d='<ul class="dropdown-menu" role="menu" aria-labelledby="drop1"><li ng-repeat="item in items" ng-class="{divider: !!item.divider, \'dropdown-submenu\': !!item.submenu && item.submenu.length}"><a ng-hide="!!item.divider" tabindex="-1" ng-href="{{item.href}}" ng-click="{{item.click}}" target="{{item.target}}" ng-bind-html-unsafe="item.text"></a></li></ul>',e=function(a,c,e){for(var g,h,i,j=0,k=a.length;k>j;j++)(g=a[j].submenu)&&(i=e.$new(),i.items=g,h=b(d)(i),h=h.appendTo(c.children("li:nth-child("+(j+1)+")")),f(g,h,i))},f=function(){var a=c.call(arguments);setTimeout(function(){e.apply(null,a)})};return{restrict:"EA",scope:!0,link:function(c,e,g){var h=a(g.bsDropdown);c.items=h(c);var i=b(d)(c);f(c.items,i,c),i.insertAfter(e),e.addClass("dropdown-toggle").attr("data-toggle","dropdown")}}}]),angular.module("$strap.directives").directive("bsModal",["$parse","$compile","$http","$timeout","$q","$templateCache",function(a,b,c,d,e,f){"use strict";return{restrict:"A",scope:!0,link:function(g,h,i){var j=a(i.bsModal),k=(j.assign,j(g));e.when(f.get(k)||c.get(k,{cache:!0})).then(function(a){angular.isObject(a)&&(a=a.data);var c=j(g).replace(".html","").replace(/[\/|\.|:]/g,"-")+"-"+g.$id,e=$('<div class="modal hide" tabindex="-1"></div>').attr("id",c).attr("data-backdrop",i.backdrop||!0).attr("data-keyboard",i.keyboard||!0).addClass(i.modalClass?"fade "+i.modalClass:"fade").html(a);$("body").append(e),h.attr("href","#"+c).attr("data-toggle","modal"),d(function(){b(e)(g)}),g._modal=function(a){e.modal(a)},g.hide=function(){e.modal("hide")},g.show=function(){e.modal("show")},g.dismiss=g.hide})}}}]),angular.module("$strap.directives").directive("bsNavbar",["$location",function(a){"use strict";return{restrict:"A",link:function(b,c){b.$watch(function(){return a.path()},function(a){c.find("li[data-match-route]").each(function(b,c){var d=angular.element(c),e=d.attr("data-match-route"),f=RegExp("^"+e+"$",["i"]);f.test(a)?d.addClass("active"):d.removeClass("active")})})}}}]),angular.module("$strap.directives").directive("bsPopover",["$parse","$compile","$http","$timeout","$q","$templateCache",function(a,b,c,d,e,f){"use strict";return $("body").on("keyup",function(a){27===a.keyCode&&$(".popover.in").each(function(){$(this).popover("hide")})}),{restrict:"A",scope:!0,link:function(d,g,h){var i=a(h.bsPopover),j=(i.assign,i(d)),k={};angular.isObject(j)&&(k=j),e.when(k.content||f.get(j)||c.get(j,{cache:!0})).then(function(a){angular.isObject(a)&&(a=a.data),h.unique&&g.on("show",function(){$(".popover.in").each(function(){var a=$(this),b=a.data("popover");b&&!b.$element.is(g)&&a.popover("hide")})}),h.hide&&d.$watch(h.hide,function(a,b){a?c.hide():a!==b&&c.show()}),g.popover(angular.extend({},k,{content:a,html:!0}));var c=g.data("popover");c.hasContent=function(){return this.getTitle()||a},c.getPosition=function(){var a=$.fn.popover.Constructor.prototype.getPosition.apply(this,arguments);return b(this.$tip)(d),d.$digest(),this.$tip.data("popover",this),a},d._popover=function(a){g.popover(a)},d.hide=function(){g.popover("hide")},d.show=function(){g.popover("show")},d.dismiss=d.hide})}}}]),angular.module("$strap.directives").directive("bsTabs",["$parse","$compile",function(a,b){"use strict";return{restrict:"A",link:function(a,c){var d=['<ul class="nav nav-tabs">',"</ul>"],e=['<div class="tab-content">',"</div>"];c.find("[data-tab]").each(function(b){var c=angular.element(this),f="tab-"+a.$id+"-"+b,g=c.hasClass("active"),h=c.hasClass("fade"),i=a.$eval(c.data("tab"));d.splice(b+1,0,"<li"+(g?' class="active"':"")+'><a href="#'+f+'" data-toggle="tab">'+i+"</a></li>"),e.splice(b+1,0,'<div class="tab-pane '+c.attr("class")+(h&&g?" in":"")+'" id="'+f+'">'+this.innerHTML+"</div>")}),c.html(d.join("")+e.join("")),b(c.children("div.tab-content"))(a)}}}]),angular.module("$strap.directives").directive("bsTimepicker",["$timeout",function(){"use strict";var a="((?:(?:[0-1][0-9])|(?:[2][0-3])|(?:[0-9])):(?:[0-5][0-9])(?::[0-5][0-9])?(?:\\s?(?:am|AM|pm|PM))?)";return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){e&&c.on("change",function(){b.$apply(function(){e.$setViewValue(c.val())})});var f=RegExp("^"+a+"$",["i"]);e.$parsers.unshift(function(a){return!a||f.test(a)?(e.$setValidity("time",!0),a):(e.$setValidity("time",!1),void 0)});var g=c.closest(".popover");g&&g.on("hide",function(){var a=c.data("timepicker");a&&(a.$widget.remove(),c.data("timepicker",null))}),c.attr("data-toggle","timepicker"),c.timepicker()}}}]),angular.module("$strap.directives").directive("bsTooltip",["$parse","$compile",function(a){"use strict";return{restrict:"A",scope:!0,link:function(b,c,d){var e=a(d.bsTooltip),f=(e.assign,e(b));b.$watch(d.bsTooltip,function(a,b){a!==b&&(f=a)}),d.unique&&c.on("show",function(){$(".tooltip.in").each(function(){var a=$(this),b=a.data("tooltip");b&&!b.$element.is(c)&&a.tooltip("hide")})}),c.tooltip({title:function(){return angular.isFunction(f)?f.apply(null,arguments):f},html:!0});var g=c.data("tooltip");g.show=function(){var a=$.Event("show");if(this.$element.trigger(a),!a.isDefaultPrevented()){var b=$.fn.tooltip.Constructor.prototype.show.apply(this,arguments);return this.tip().data("tooltip",this),b}},g.hide=function(){var a=$.Event("hide");return this.$element.trigger(a),a.isDefaultPrevented()?void 0:$.fn.tooltip.Constructor.prototype.hide.apply(this,arguments)},b._tooltip=function(a){c.tooltip(a)},b.hide=function(){c.tooltip("hide")},b.show=function(){c.tooltip("show")},b.dismiss=b.hide}}}]),angular.module("$strap.directives").directive("bsTypeahead",["$parse",function(a){"use strict";return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){var f=a(d.bsTypeahead),g=(f.assign,f(b));b.$watch(d.bsTypeahead,function(a,b){a!==b&&(g=a)}),c.attr("data-provide","typeahead"),c.typeahead({source:function(){return angular.isFunction(g)?g.apply(null,arguments):g},minLength:d.minLength||1,items:d.items,updater:function(a){return e&&b.$apply(function(){e.$setViewValue(a)}),a}});var h=c.data("typeahead");h.lookup=function(){var a;return this.query=this.$element.val()||"",this.query.length<this.options.minLength?this.shown?this.hide():this:(a=$.isFunction(this.source)?this.source(this.query,$.proxy(this.process,this)):this.source,a?this.process(a):this)},"0"===d.minLength&&setTimeout(function(){c.on("focus",function(){0===c.val().length&&setTimeout(c.typeahead.bind(c,"lookup"),200)})})}}}]),angular.module("ui.bootstrap",["ui.bootstrap.modal"]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(a,b){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(c){b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).directive("modalWindow",["$timeout",function(a){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(b,c,d){b.windowClass=d.windowClass||"",a(function(){b.animate=!0})}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(a){var b=k.get(a).value;k.remove(a),b.modalDomEl.remove(),-1==e()&&(h.remove(),h=void 0),b.modalScope.$destroy()}var g,h,i=c.$new(!0),j=a.find("body").eq(0),k=d.createNew(),l={};return c.$watch(e,function(a){i.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(a,c){k.add(a,{deferred:c.deferred,modalScope:c.scope,backdrop:c.backdrop,keyboard:c.keyboard});var d=angular.element("<div modal-window></div>");d.attr("window-class",c.windowClass),d.attr("index",k.length()-1),d.html(c.content);var f=b(d)(c.scope);k.top().value.modalDomEl=f,j.append(f),e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(i),j.append(h))},l.close=function(a,b){var c=k.get(a);c&&(c.value.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.modal"]),angular.module("ui.bootstrap.tpls",["template/modal/backdrop.html","template/modal/window.html"]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(a,b){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(c){b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).directive("modalWindow",["$timeout",function(a){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(b,c,d){b.windowClass=d.windowClass||"",a(function(){b.animate=!0})}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(a){var b=k.get(a).value;k.remove(a),b.modalDomEl.remove(),-1==e()&&(h.remove(),h=void 0),b.modalScope.$destroy()}var g,h,i=c.$new(!0),j=a.find("body").eq(0),k=d.createNew(),l={};return c.$watch(e,function(a){i.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(a,c){k.add(a,{deferred:c.deferred,modalScope:c.scope,backdrop:c.backdrop,keyboard:c.keyboard});var d=angular.element("<div modal-window></div>");d.attr("window-class",c.windowClass),d.attr("index",k.length()-1),d.html(c.content);var f=b(d)(c.scope);k.top().value.modalDomEl=f,j.append(f),e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(i),j.append(h))},l.close=function(a,b){var c=k.get(a);c&&(c.value.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}" ng-click="close($event)"></div>')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(a){a.put("template/modal/window.html",'<div class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10}" ng-transclude></div>')}]),angular.module("WebPaige.Services.Session",["ngResource"]).factory("Session",["$rootScope","$http","Storage",function(a,b,c){return{check:function(){var a=angular.fromJson(c.cookie.get("session"));return a?(this.set(a.id),!0):!1},cookie:function(){for(var a,b=document.cookie.split(";"),c=0;c<b.length;c++)if(a=b[c].split("="),"WebPaige.session"==a[0].trim())return angular.fromJson(a[1])},get:function(a){return this.check(a),this.set(a.id),a.id},set:function(d){var e={id:d,time:new Date};return c.cookie.add("session",angular.toJson(e)),a.session=e,b.defaults.headers.common["X-SESSION_ID"]=a.session.id,e},clear:function(){a.session=null,b.defaults.headers.common["X-SESSION_ID"]=null}}}]),angular.module("WebPaige.Services.Dater",["ngResource"]).factory("Dater",["$rootScope","Storage",function(a,b){return{current:{today:function(){return Date.today().getDayOfYear()+1},week:function(){return(new Date).getWeek()},month:function(){return(new Date).getMonth()+1}},readable:{date:function(b){return new Date(b).toString(a.config.formats.date)}},convert:{absolute:function(a,b,c){var d=a.split("-"),e=new Date(Date.parse(d[2]+"-"+d[1]+"-"+d[0]+" "+b)).getTime();return c?e/1e3:e}},calculate:{diff:function(a){return new Date(a.end).getTime()-new Date(a.start).getTime()}},getThisMonth:function(){return(new Date).toString("M")},getThisYear:function(){return(new Date).toString("yyyy")},getMonthTimeStamps:function(){for(var a={},b=this.getThisYear(),c=0;12>c;c++){var d=new Date(b,c).moveToFirstDayOfMonth(),e=new Date(b,c).moveToLastDayOfMonth(),f={first:{day:d,timeStamp:d.getTime()},last:{day:e,timeStamp:e.getTime()},totalDays:Date.getDaysInMonth(b,c)};a[c+1]=f}return a},getWeekTimeStamps:function(){for(var a,b=[],c={},d=this.getThisYear(),e=(new Date(d,0).moveToFirstDayOfMonth(),new Date(d,0).moveToFirstDayOfMonth().last().sunday().addWeeks(0)),f=new Date(e),g=0;53>g;g++)a=0==g?e.addWeeks(1):new Date(b[g-1]).addWeeks(1),b.push(new Date(a));b.unshift(f);for(var g=(new Date(b[51].addWeeks(1)),0);55>g;g++)c[g+1]={first:{day:b[g],timeStamp:new Date(b[g]).getTime()},last:{day:b[g+1],timeStamp:new Date(b[g+1]).getTime()}};return delete c[54],delete c[55],c},getDayTimeStamps:function(){for(var a,b=[],c={},d=this.getThisYear(),e=new Date(d,0).moveToFirstDayOfMonth(),f=0;366>f;f++)a=0==f?e:new Date(b[f-1]).addDays(1),b.push(new Date(a));for(var f=0;366>f;f++)c[f+1]={first:{day:b[f],timeStamp:new Date(b[f]).getTime()},last:{day:b[f+1],timeStamp:new Date(b[f+1]).getTime()}};return c[366].timeStamp?c.total=366:(delete c[366],c.total=365),c},registerPeriods:function(){angular.fromJson(b.get("periods")||"{}");b.add("periods",angular.toJson({months:this.getMonthTimeStamps(),weeks:this.getWeekTimeStamps(),days:this.getDayTimeStamps()}))},getPeriods:function(){return angular.fromJson(b.get("periods"))}}}]),angular.module("WebPaige.Services.MD5",["ngResource"]).factory("MD5",function(){return function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=Array(),y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}}),angular.module("WebPaige.Services.Storage",["ngResource"]).factory("Storage",["$rootScope","$config",function(a,b){"."!==b.title.substr(-1)&&(b.title=b.title?b.title+".":"");var c=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},d=function(a,d){if(!c())return!1;if(!d&&0!==d&&""!==d)return!1;try{localStorage.setItem(b.title+a,d)}catch(e){return!1}return!0},e=function(a){if(!c())return!1;var d=localStorage.getItem(b.title+a);return d?d:null},f=function(a){if(!c())return!1;try{localStorage.removeItem(b.title+a)}catch(d){return!1}return!0},g=function(){if(!c())return!1;var a=b.title.length;for(var d in localStorage)if(d.substr(0,a)===b.title)try{f(d.substr(a))}catch(e){return!1}return!0},h=function(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(a){return!1}},i=function(a,c){if(!h())return!1;if(!c&&0!==c&&""!==c)return!1;try{sessionStorage.setItem(b.title+a,c)}catch(d){return!1}return!0},j=function(a){if(!h())return!1;var c=sessionStorage.getItem(b.title+a);return c?c:null},k=function(a){if(!h())return!1;try{sessionStorage.removeItem(b.title+a)}catch(c){return!1}return!0},l=function(){if(!h())return!1;var a=b.title.length;for(var c in sessionStorage)if(c.substr(0,a)===b.title)try{k(c.substr(a))}catch(d){return!1}return!0},m=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(a){return!1}},n=function(a,c){if("undefined"==typeof c)return!1;if(!m())return!1;try{var d="",e=new Date;null===c&&(b.cookie.expiry=-1,c=""),0!==b.cookie.expiry&&(e.setTime(e.getTime()+60*b.cookie.expiry*60*1e3),d="; expires="+e.toGMTString()),document.cookie=b.title+a+"="+c+d+"; path="+b.cookie.path}catch(f){return!1}return!0},o=function(c){if(!m())return a.$broadcast("StorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var d=document.cookie.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1,f.length);if(0==f.indexOf(b.title+c+"="))return decodeURIComponent(f.substring(b.title.length+c.length+1,f.length))}return null},p=function(a){n(a,null)},q=function(){for(var a=null,c=b.title.length,d=document.cookie.split(";"),e=0;e<d.length;e++){for(a=d[e];" "==a.charAt(0);)a=a.substring(1,a.length);key=a.substring(c,a.indexOf("=")),p(key)}},r=function(a){var b=a?localStorage.key:localStorage;return(.0009765625*(3+16*b.length/8192)).toPrecision(2)+" MB"},s=function(){return angular.fromJson(e("periods"))},t=function(){return angular.fromJson(e("groups"))},u=function(){return angular.fromJson(e("members"))},v=function(){var b=angular.fromJson(e("resources"));return b.settingsWebPaige?angular.fromJson(b.settingsWebPaige):a.config.defaults.settingsWebPaige},w=function(a,b){var c=angular.fromJson(e("avatarUrls"));c?angular.forEach(c,function(d){if(d.id==a)d.url=b;else{var e={id:a,url:b};c.add(e)}}):c=[{id:a,url:b}],d("avatarUrls",angular.toJson(c))},x=function(a){var b,c=angular.fromJson(e("avatarUrls"));return c&&angular.forEach(c,function(c){c.id==a&&(b=c.url)}),b};return{isSupported:c,add:d,get:e,remove:f,clearAll:g,session:{add:i,get:j,remove:k,clearAll:l},cookie:{add:n,get:o,remove:p,clearAll:q},size:r,local:{periods:s,groups:t,members:u,settings:v},avatar:{addurl:w,geturl:x}}}]),angular.module("WebPaige.Services.Strings",["ngResource"]).factory("Strings",function(){return{truncate:function(a,b,c){var d=a.length>b,e=d?a.substr(0,b-1):a,e=c&&d?e.substr(0,e.lastIndexOf(" ")):e;return d?e+"..":e},toTitleCase:function(a){return a?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):void 0}}}),angular.module("WebPaige.Services.Generators",["ngResource"]).factory("Generators",function(){return{range:function(){var a=5,b=120;return Math.floor(Math.random()*(b-a+1))+a},number:function(){return Math.floor(9e6*Math.random())},list:function(){for(var a=[],b=["1111111","2222222","3333333","4444444","5555555","6666666","7777777","8888888","9999999"],c=0;c<this.range();c++){var d=String(this.number());d.length>6&&a.push(Number(d))}return{normals:a,premiums:b}}}}),angular.module("WebPaige.Services.Sloter",["ngResource"]).factory("Sloter",["$rootScope","Storage",function(a,b){return{get:{groups:function(){var a={};return angular.forEach(b.local.groups(),function(b){a[b.uuid]=b.name}),a},members:function(){var a={};return angular.forEach(b.local.members(),function(b){a[b.uuid]=b.name}),a}},wrapper:function(a){return'<span style="display:none;">'+a+"</span>"},secret:function(a){return'<span class="secret">'+a+"</span>"},addLoading:function(a,b,c){return angular.forEach(c,function(c){b.push({start:a.periods.end,end:15778368e5,group:c,content:"loading",className:"state-loading-right",editable:!1}),b.push({start:0,end:a.periods.start,group:c,content:"loading",className:"state-loading-left",editable:!1})}),b},user:function(b,c,d){var e=this;return angular.forEach(b.user,function(b){angular.forEach(d.legenda,function(f,g){b.text==g&&f&&c.push({start:Math.round(b.start),end:Math.round(b.end),group:b.recursive?e.wrapper("b")+a.ui.planboard.weeklyPlanning+e.wrapper("recursive"):e.wrapper("a")+a.ui.planboard.planning+e.wrapper("planning"),content:e.secret(angular.toJson({type:"slot",id:b.id,recursive:b.recursive,state:b.text})),className:d.states[b.text].className,editable:!0})})}),c=e.addLoading(b,c,[e.wrapper("b")+a.ui.planboard.weeklyPlanning+e.wrapper("recursive"),e.wrapper("a")+a.ui.planboard.planning+e.wrapper("planning")])},profile:function(b,c){var d=this,e=[];return angular.forEach(b,function(b){angular.forEach(c.legenda,function(f,g){b.text==g&&f&&e.push({start:Math.round(b.start),end:Math.round(b.end),group:b.recursive?d.wrapper("b")+a.ui.planboard.weeklyPlanning+d.wrapper("recursive"):d.wrapper("a")+a.ui.planboard.planning+d.wrapper("planning"),content:d.secret(angular.toJson({type:"slot",id:b.id,recursive:b.recursive,state:b.text})),className:c.states[b.text].className,editable:!0})})}),e.push({start:0,end:1,group:d.wrapper("b")+a.ui.planboard.weeklyPlanning+d.wrapper("recursive"),content:"",className:null,editable:!1}),e.push({start:0,end:1,group:d.wrapper("a")+a.ui.planboard.planning+d.wrapper("planning"),content:"",className:null,editable:!1}),e},namer:function(a,b,c){var d,e=this.get.groups(),f=e[a.aggs.id],g='<a href="#/groups?uuid='+a.aggs.id+'#view">'+f+"</a>";if("all"==a.aggs.division||void 0==a.aggs.division)d=1==c?g:"<span>"+f+"</span>";else{var h;angular.forEach(b,function(b){b.id==a.aggs.division&&(h=b.label)}),d=1==c?g:"<span>"+f+"</span>",d+=' <span class="label">'+h+"</span>"}return d},bars:function(a,b,c,d){var e=this,f=0;return angular.forEach(a.aggs.data,function(a){a.wish>f&&(f=a.wish)}),angular.forEach(a.aggs.data,function(g){var h=f,i=g.wish,j=i,k=Math.round(i/h*80+20),l=k,m="height:"+k+"px;",n='<div class="requirement" style="'+m+'" title="Minimum aantal benodigden: '+i+' personen"></div>';i=g.wish+g.diff;var o=i;if(k=Math.round(i/h*80+20),g.diff>=0&&g.diff<7)switch(g.diff){case 0:var p=c.densities.even;break;case 1:var p=c.densities.one;break;case 2:var p=c.densities.two;break;case 3:var p=c.densities.three;break;case 4:var p=c.densities.four;break;case 5:var p=c.densities.five;break;case 6:var p=c.densities.six}else if(g.diff>=7)var p=c.densities.more;else var p=c.densities.less;var q='<span class="badge badge-inverse">'+g.diff+"</span>";o>j&&(k=l),m="height:"+k+"px;background-color: "+p+";";var r='<div class="bar" style="'+m+'"  title="Huidig aantal beschikbaar: '+i+' personen">'+q+"</div>";(g.diff>0&&c.legenda.groups.more||0==g.diff&&c.legenda.groups.even||g.diff<0&&c.legenda.groups.less)&&b.push({start:Math.round(g.start),end:Math.round(g.end),group:e.wrapper("c")+d,content:n+r+e.secret(angular.toJson({type:"group",diff:g.diff,group:d})),className:"group-aggs",editable:!1}),b=e.addLoading(a,b,[e.wrapper("c")+d])}),b},aggs:function(a,b,c,d){var e=this;return angular.forEach(a.aggs.data,function(f){var g;if(f.diff>=0&&f.diff<7)switch(f.diff){case 0:g="even";break;case 1:g=1;break;case 2:g=2;break;case 3:g=3;break;case 4:g=4;break;case 5:g=5;break;case 6:g=6}else g=f.diff>=7?"more":"less";(f.diff>0&&c.legenda.groups.more||0==f.diff&&c.legenda.groups.even||f.diff<0&&c.legenda.groups.less)&&b.push({start:Math.round(f.start),end:Math.round(f.end),group:e.wrapper("c")+d,content:g+e.secret(angular.toJson({type:"group",diff:f.diff,group:d})),className:"agg-"+g,editable:!1}),b=e.addLoading(a,b,[e.wrapper("c")+d])}),b},wishes:function(a,b,c){var d=this;return angular.forEach(a.aggs.wishes,function(e){if(e.count>=7)var f="wishes-more";
else if(0==e.count)var f="wishes-even";else var f="wishes-"+e.count;b.push({start:Math.round(e.start),end:Math.round(e.end),group:d.wrapper("c")+c+" (Wishes)",content:'<span class="badge badge-inverse">'+e.count+"</span>"+d.secret(angular.toJson({type:"wish",wish:e.count,group:c,groupId:a.aggs.id})),className:f,editable:!1}),b=d.addLoading(a,b,[d.wrapper("c")+c+" (Wishes)"])}),b},members:function(b,c){var d=this,e=Number(Date.now());return angular.forEach(b.members,function(f){var g=[];"teams"==b.section?(console.log("data.teams.tasks ",b.teams.tasks),null!=b.teams.tasks[f.memId]&&g.add(b.teams.tasks[f.memId])):"clients"==b.section&&(console.log("data.clients.tasks ",b.clients.tasks),null!=b.clients.tasks[f.memId]&&g.add(b.clients.tasks[f.memId]));angular.forEach(g,function(d){var g="";"teams"==b.section?g=a.getClientByID(d.relatedClientUuid):"clients"==b.section&&(g=a.getTeamMemberById(d.assignedTeamMemberUuid));var h="";"undefined"!=typeof g&&(h=g.firstName+" "+g.lastName),0==d.plannedEndVisitTime&&(d.plannedEndVisitTime=e),c.push({start:Math.round(d.plannedStartVisitTime),end:Math.round(d.plannedEndVisitTime),group:f.head,content:"<span>"+h+"</span><input type=hidden value='"+angular.toJson({type:"slot",id:d.uuid,mid:d.authorUuid,state:d.description,clientUuid:d.relatedClientUuid,memberId:d.assignedTeamMemberUuid})+"'>",className:"state-available",editable:!1})}),c=d.addLoading(b,c,[f.head]),angular.forEach(f.stats,function(a){var b=a.state.split(".");b.reverse(),a.state="bar-"+b[0]})}),c},pies:function(a){document.getElementById("groupPie").innerHTML="";var b=[],c={more:"#415e6b",even:"#ba6a24",less:"#a0a0a0"},d=[],e=[];angular.forEach(a.aggs.ratios,function(a,d){0!=a&&b.push({ratio:a,color:c[d]})}),b=b.sort(function(a,b){return b.ratio-a.ratio}),angular.forEach(b,function(a){d.push(a.color),e.push(a.ratio)});{var f=Raphael("groupPie");f.piechart(120,120,100,e,{colors:d})}},process:function(a,b,c,d){var e=this,f=[];return a.members&&(f=e.members(a,f,b,d)),f}}}]),angular.module("WebPaige.Filters",["ngResource"]).filter("translatePackage",["$config",function(a){return function(b){if(b){var c;return angular.forEach(a.packages,function(a){a.id==b&&(c=a)}),c.label}}}]).filter("translateCountry",["$config",function(a){return function(b){if(b){var c;return angular.forEach(a.countries,function(a){a.id==b&&(c=a)}),c.label}}}]).filter("translateRegion",["$config",function(a){return function(b,c){if(b&&c){var d;return angular.forEach(a.regions[c],function(a){a.id==b&&(d=a)}),d.label}}}]).filter("translateService",["$config",function(a){return function(b){if(b){var c;return angular.forEach(a.virtuals,function(a){a.id==b&&(c=a)}),c.label}}}]).filter("translateRole",["$config",function(a){return function(b){var c;return angular.forEach(a.roles,function(a){a.id==b&&(c=a.label)}),c}}]).filter("translateFunc",["$config",function(a){return function(b){var c;return angular.forEach(a.mfunctions,function(a){a.id==b&&(c=a.label)}),c}}]).filter("stateDataIcon",["$config",function(a){return function(b,c){var d;return angular.forEach(a.stateIcons,function(a){angular.lowercase(a.name)==angular.lowercase(b)&&("data_icon"==c?d=a.data_icon:"class_name"==c&&(d=a.class_name))}),d}}]).filter("stateColor",["$config",function(a){return function(b){var c=a.stateColors.none;return angular.forEach(b,function(b){"availability"==angular.lowercase(b.name)&&b.share&&("available"==angular.lowercase(b.value)||"working"==angular.lowercase(b.value)?c=a.stateColors.availalbe:"unavailable"==angular.lowercase(b.value)?c=a.stateColors.busy:"offline"==angular.lowercase(b.value)&&(c=a.stateColors.offline))}),c}}]).filter("stateValue",["$config",function(){return function(a,b){if("location"==angular.lowercase(a.name)){var c=a.value,d=c.match(/\((.*?)\)/);if(null==d)return c;var e=d[1];return c=c.replace(d[0],""),"data"==b?e:c}return a.value}}]).filter("rangeMainFilter",["Dater","Storage",function(a){var b=a.getPeriods();return function(c){new Date(c.end).getTime()-new Date(c.start).getTime()==86401e3&&(c.start=new Date(c.end).addDays(-1));var c={start:{real:new Date(c.start).toString("dddd, MMMM d"),month:new Date(c.start).toString("MMMM"),day:new Date(c.start).toString("d")},end:{real:new Date(c.end).toString("dddd, MMMM d"),month:new Date(c.end).toString("MMMM"),day:new Date(c.end).toString("d")}},d=Date.getMonthNumberFromName(c.start.month);return(Math.round(c.start.day)+1==c.end.day&&c.start.hour==c.end.hour||c.start.day==c.end.day)&&c.start.month==c.end.month?c.start.real+", "+a.getThisYear():1==c.start.day&&c.end.day==b.months[d+1].totalDays?c.start.month+", "+a.getThisYear():c.start.real+" / "+c.end.real+", "+a.getThisYear()}}]).filter("rangeMainWeekFilter",["Dater","Storage",function(a){a.getPeriods();return function(b){if(b){var b={start:new Date(b.start).toString("dddd, MMMM d"),end:new Date(b.end).toString("dddd, MMMM d")};return b.start+" / "+b.end+", "+a.getThisYear()}}}]).filter("rangeInfoFilter",["Dater","Storage",function(a){var b=a.getPeriods();return function(a){var c=new Date(a.range.end).getTime()-new Date(a.range.start).getTime();if(c>26784e5)return"Total selected days: "+Math.round(c/864e5);if(a.scope.day){var d={start:new Date(a.range.start).toString("HH:mm"),end:new Date(a.range.end).toString("HH:mm")};return"00:00"==d.end&&(d.end="24:00"),"Time: "+d.start+" / "+d.end}return a.scope.week?"Week number: "+a.current.week:a.scope.month?"Month number: "+a.current.month+", Total days: "+b.months[a.current.month].totalDays:void 0}}]).filter("rangeInfoWeekFilter",["Dater","Storage",function(a){a.getPeriods();return function(a){return a?"Week number: "+a.current.week:void 0}}]).filter("nicelyDate",["$rootScope",function(a){return function(b){return"string"==typeof b&&(b=Number(b)),10==String(b).length&&(b*=1e3),new Date(b).toString(a.config.formats.date)}}]).filter("nicelyTime",["$rootScope",function(a){return function(b){return"string"==typeof b&&(b=Number(b)),new Date(b).toString(a.config.formats.time)}}]).filter("i18n_spec",["$rootScope",function(a){return function(b,c){var d=c.split("."),e=a.ui[d[0]][d[1]],e=e.replace("$v",b);return e}}]).filter("stateIcon",["$rootScope",function(){return function(a){switch(a){case"emotion":return"icon-face";case"availability":return"icon-avail";case"location":return"icon-location";case"activity":return"icon-activity";case"reachability":return"icon-reach";default:return"icon-info-sign"}}}]).filter("escape",["$rootScope",function(){return function(a){if(!a||-1==a.indexOf("."))return a;var b=a.replace(".","").replace("@","");return b}}]),angular.module("WebPaige.Controllers.Login",[]).controller("login",["$rootScope","$location","$q","$scope","Session","User","Teams","Clients","Storage","$routeParams","Settings","Profile","MD5",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){o.progress(100,a.ui.login.loading_everything),o.redirectToTeamPage()}var o=this;"/logout"==b.path()&&$("body").css({backgroundColor:"#1dc8b6",backgroundImage:"none"}),j.uuid&&j.key?(d.views={changePass:!0},d.changepass={uuid:j.uuid,key:j.key}):d.views={login:!0,forgot:!1},d.alert={login:{display:!1,type:"",message:""},forgot:{display:!1,type:"",message:""}},i.session.get("app")||i.session.add("app","{}"),$(".navbar").hide(),$("#footer").hide(),$("#watermark").hide(),$("body").css({backgroundColor:"#1dc8b6"});var p=angular.fromJson(i.get("logindata"));p&&p.remember&&(d.logindata=p),d.login=function(){return $("#alertDiv").hide(),d.logindata&&d.logindata.username&&d.logindata.password?($("#login button[type=submit]").text(a.ui.login.button_loggingIn).attr("disabled","disabled"),i.add("logindata",angular.toJson({username:d.logindata.username,password:d.logindata.password,remember:d.logindata.remember})),o.auth(d.logindata.username,m(d.logindata.password)),void 0):(d.alert={login:{display:!0,type:"alert-error",message:a.ui.login.alert_fillfiled}},$("#login button[type=submit]").text(a.ui.login.button_login).removeAttr("disabled"),!1)},o.auth=function(b,c){f.login(b.toLowerCase(),c).then(function(b){return 400==b.status||403==b.status||404==b.status?(d.alert={login:{display:!0,type:"alert-error",message:a.ui.login.alert_wrongUserPass}},$("#login button[type=submit]").text(a.ui.login.button_loggingIn).removeAttr("disabled"),!1):0==b.status?(d.alert={login:{display:!0,type:"alert-error",message:a.ui.login.alert_network}},$("#login button[type=submit]").text(a.ui.login.button_loggingIn).removeAttr("disabled"),!1):(e.set(b["X-SESSION_ID"]),o.preloader(),void 0)})};var q=function(b,c){"team"==c?angular.forEach(b,function(b){var c=a.config.host+a.config.namespace+"/team/member/"+b.uuid+"/photourl";g.loadImg(c).then(function(a){a.path&&(i.avatar.addurl(b.uuid,a.path),console.log("Member Avatar path for "+b.uuid+" - "+a.path),console.log("get it from the storage "+i.avatar.geturl(b.uuid)))})}):"client"==c&&angular.forEach(b,function(b){var c=a.config.host+a.config.namespace+"/client/"+b.uuid+"/photourl";h.loadImg(c).then(function(a){a.path&&(i.avatar.addurl(b.uuid,a.path),console.log("Client Avatar path for "+b.uuid+" - "+a.path),console.log("get it from the storage "+i.avatar.geturl(b.uuid)))})})};o.preloader=function(){$("#login").hide(),$("#download").hide(),$("#preloader").show(),o.progress(20,a.ui.login.loading_User),f.memberInfo().then(function(b){b.error?console.warn("error ->",b):(a.app.resources=b,o.progress(40,a.ui.login.loading_Teams),g.query(!0,{}).then(function(b){console.log("got teams ",b),console.log("got members not in any teams"),g.queryMembersNotInTeams().then(function(a){console.log("all members loaded (include the members not in any teams)",a),q(a,"team")},function(){}),b.error&&console.warn("error ->",b),console.log("start to query team-clientgroup relation async "),o.progress(60,a.ui.login.loading_clientGroups),g.queryClientGroups(b).then(function(){console.log("got clientGroups belong to the teams "),o.progress(80,a.ui.login.loading_clientGroups),h.queryAll().then(function(a){console.log("got all clients in or not in the client groups ",a),q(a,"client"),h.query(!1,{}).then(function(){console.log("got all grous and the clients in the groups "),n()},function(a){deferred.resolve({error:a})})},function(a){deferred.resolve({error:a})})},function(a){deferred.resolve({error:a})})},function(a){deferred.resolve({error:a})}))})},o.redirectToTeamPage=function(){b.path("/team"),setTimeout(function(){$("body").css({background:"none"}),$(".navbar").show(),a.browser.mobile||$("#footer").show(),$("#watermark").show(),$("body").css({background:"url(../img/bg.jpg) repeat"})},100)},o.progress=function(a,b){$("#preloader .progress .bar").css({width:a+"%"}),$("#preloader span").text(b)}}]),angular.module("WebPaige.Controllers.Forgotpass",[]).controller("forgotpass",["$rootScope","$scope","$location",function(a){a.fixStyles()}]),angular.module("WebPaige.Controllers.Register",[]).controller("register",["$rootScope","$scope","$location",function(a){a.fixStyles()}]),angular.module("WebPaige.Controllers.Logout",[]).controller("logout",["$rootScope","$scope","$window","Session","User","Storage",function(a,b,c,d,e,f){$(".navbar").hide(),$("#footer").hide();var g=angular.fromJson(f.get("logindata"));e.logout().then(function(a){a.error?console.warn("error ->",a):(f.session.clearAll(),f.add("logindata",angular.toJson(g)),f.cookie.clearAll(),c.location.href="logout.html")})}]),angular.module("WebPaige.Controllers.Core",[]).controller("core",["$rootScope","$scope","$location","Generators","Team",function(a,b,c,d,e){function f(a){b.views={purchaser:!1,manager:!1,notifier:!1,reporter:!1,guarder:!1},b.views[a]=!0}if(console.log(e),a.fixStyles(),b.order={"package":null,country:31},b.packages=a.config.packages,b.countries=a.config.countries,b.virtuals=a.config.virtuals,b.defaults={"package":1,country:31},b.order.country=b.defaults.country,b.$watch("order",function(){if(b.regions=a.config.regions[b.order.country],b.ranges=a.config.ranges[b.order.virtual],b.order.package){var c={monthly:a.config.packages[b.order.package].prices.monthly,yearly:a.config.packages[b.order.package].prices.yearly};b.prices={monthly:b.order.premium?c.monthly.premium:c.monthly.normal,yearly:b.order.premium?c.yearly.premium:c.yearly.normal}}},!0),b.resetPurchaser=function(){b.order={"package":null,country:b.defaults.country,region:null}},b.setRegion=function(){b.order.region&&(b.numbers=d.list())},b.setVirtualArea=function(){b.order.virtual&&(b.numbers=d.list())},b.setPackage=function(a){b.order.package=Number(a),b.order.number=null},b.tabs={normals:!0,premiums:!1},b.setViewTo=function(a){b.$watch(a,function(){c.hash(a),f(a)})},c.hash())var g=c.hash();else{var g="purchaser";c.hash("purchaser")}f(g),b.switchStep=function(a){b.purchaser={step:a}},b.switchStep(0),b.increaseStep=function(){b.purchaser.step<5&&b.switchStep(b.purchaser.step+1)},b.decreaseStep=function(){b.purchaser.step>1&&b.switchStep(b.purchaser.step-1)}}]),angular.module("WebPaige.Controllers.Profile",[]).controller("profileCtrl",["$rootScope","$scope","$q","$location","$window","$route","data","Profile","Storage","Teams","Dater","MD5","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c){b.views={profile:!1,edit:!1,editImg:!1,password:!1,timeline:!1},b.views[c]=!0,b.views.user=a.app.resources.uuid==f.current.params.userId?!0:!1;var d=f.current.params.userId,e=b.imgHost+b.ns+"/team/member/"+d+"/photourl";j.loadImg(e).then(function(a){var c=d.replace(".","").replace("@","");if(!a.status||404!=a.status&&403!=a.status&&500!=a.status){var e=b.imgHost.replace("\\:",":")+a.path;$("#profile #img_"+c).css("background-image","url("+e+")")}else console.log("loading pic ",a),$("#profile #img_"+c).css("background-image","url("+b.noImgURL+")")},function(a){console.log("error when load pic "+a)})}a.fixStyles(),b.self=this,b.periods=k.getPeriods(),b.imgHost=profile.host(),b.ns=profile.ns(),b.current={day:Date.today().getDayOfYear()+1,week:(new Date).getWeek(),month:(new Date).getMonth()+1},b.roles=a.config.roles,b.mfuncs=a.config.mfunctions,g.slots&&(g.user=g.slots.data),b.data=g,b.noImgURL=a.config.noImgURL,b.profilemeta=g.resources,b.profilemeta.birthday=m("nicelyDate")(g.resources.birthDate),b.currentRole=b.profilemeta.role;var o=[],p=angular.fromJson(i.get("Teams"));angular.forEach(b.profilemeta.teamUuids,function(a){angular.forEach(p,function(b){b.uuid==a&&o.add(b)})}),0==o.length&&angular.forEach(p,function(a){a.uuid==sessionStorage.getItem(g.resources.uuid+"_team")&&o.add(a)}),b.teams=o,b.selectTeams=p,b.passwords={current:"",new1:"",new2:""},b.forms={add:!1,edit:!1},b.toggleSlotForm=function(){b.forms.add?b.resetInlineForms():(b.slot={},b.slot={start:{date:(new Date).toString(a.config.formats.date),time:(new Date).toString(a.config.formats.time),datetime:(new Date).toISOString()},end:{date:(new Date).toString(a.config.formats.date),time:(new Date).addHours(1).toString(a.config.formats.time),datetime:(new Date).toISOString()},state:"",recursive:!1,id:""},b.forms={add:!0,edit:!1})},b.resetInlineForms=function(){b.slot={},b.original={},b.forms={add:!1,edit:!1}},n(d.hash()),b.setViewTo=function(a){b.$watch(d.hash(),function(){d.hash(a),n(a)})},b.save=function(c){a.statusBar.display(a.ui.profile.saveProfile),(null==c.teamUuids||"undefined"==typeof c.teamUuids[0])&&(c.teamUuids=[],0==b.teams.length?c.teamUuids.push(sessionStorage.getItem(c.uuid+"_team")):c.teamUuids.push(b.teams[0].uuid));try{c.birthDate=k.convert.absolute(c.birthday,0)}catch(d){return console.log(d),a.notifier.error(a.ui.teamup.birthdayError),void 0}delete c.birthday,h.save(f.current.params.userId,c).then(function(d){if(d.error)a.notifier.error("Error with saving profile information."),console.warn("error ->",d);else{a.statusBar.display(a.ui.profile.refreshing);var e=f.current.params.userId==a.app.resources.uuid?!0:!1;h.get(f.current.params.userId,e).then(function(d){d.error?(a.notifier.error("Error with getting profile data."),console.warn("error ->",d)):(a.notifier.success(a.ui.profile.dataChanged),b.data=d,a.statusBar.off(),b.setViewTo("profile"),angular.forEach(c.teamUuids,function(b){var c={uuid:b};a.statusBar.display(a.ui.profile.refreshTeam),j.query(!1,c).then(function(){a.statusBar.off()})}))})}})},b.change=function(c){return""==c.new1||""==c.new2?(a.notifier.error(a.ui.profile.pleaseFill,!0),!1):c.new1!=c.new2?(a.notifier.error(a.ui.profile.passNotMatch,!0),!1):(a.app.resources.askPass==l(c.current)?(a.statusBar.display(a.ui.profile.changingPass),h.changePassword(c).then(function(c){c.error?(a.notifier.error("Error with changing password."),console.warn("error ->",c)):(a.statusBar.display(a.ui.profile.refreshing),h.get(a.app.resources.uuid,!0).then(function(c){c.error?(a.notifier.error("Error with getting profile data."),console.warn("error ->",c)):(a.notifier.success(a.ui.profile.passChanged),b.data=c,a.statusBar.off())}))})):a.notifier.error(a.ui.profile.passwrong,!0),void 0)},b.redraw=function(){setTimeout(function(){},100)},b.editProfile=function(){n("edit")},b.editImg=function(){b.uploadURL=b.imgHost+b.ns+"/team/member/"+f.current.params.userId+"/photourl",j.loadImg(b.uploadURL).then(function(a){var c=b.imgHost.replace("\\","");a.path&&(b.avatarURL=c+a.path),b.uploadURL=c+b.ns+"/team/member/"+f.current.params.userId+"/photo",b.setViewTo("editImg")})},b.deleteProfile=function(){window.confirm(a.ui.teamup.deleteConfirm)&&(a.statusBar.display(a.ui.teamup.deletingMember),j.deleteMember(b.profilemeta.uuid).then(function(c){c.uuid&&(a.notifier.success(a.ui.teamup.dataChanged),angular.forEach(b.profilemeta.teamUuids,function(b){a.statusBar.display(a.ui.teamup.refreshing);var c={uuid:b};j.query(!1,c).then(function(){a.statusBar.off()})}),j.queryMembersNotInTeams().then(function(){console.log("members not in any teams loaded "),a.statusBar.off()},function(a){console.log(a)}))},function(a){console.log(a)}))}}]),angular.module("WebPaige.Controllers.Teams",[]).controller("teamCtrl",["$rootScope","$scope","$location","Teams","data","$route","$routeParams","Storage","MD5","Dater",function(a,b,c,d,e,f,g,h,i,j){function k(c){angular.forEach(e.teams,function(a){a.uuid==c&&(b.team=a)}),b.members=e.members[c],b.current=c,angular.forEach(b.members,function(a){var c=b.imgHost+b.ns+"/team/member/"+a.uuid+"/photourl";d.loadImg(c).then(function(c){var d=a.uuid.replace(".","").replace("@","");if(!c.status||404!=c.status&&403!=c.status&&500!=c.status){var e=b.imgHost+c.path;$(".tab-content #img_"+d).css("background-image","url("+e+")")}else console.log("no pics ",c)},function(a){console.log("error when load pic "+a)})}),b.team.phone=a.ui.teamup.loadingNumber,d.loadTeamCallinNumber(b.team.uuid).then(function(a){b.team.phone=a.phone})}a.fixStyles(),b.members=e.members,b.teams=e.teams;var l=c.search();b.imgHost=profile.host(),b.ns=profile.ns(),b.search={query:""},b.selection={},b.data=e,b.roles=a.config.roles,b.mfuncs=a.config.mfunctions;var m,n;l.uuid||c.hash()?l.uuid?(m=l.uuid,n=c.hash()):(m=e.teams[0].uuid,n=c.hash(),c.search({uuid:e.teams[0].uuid})):(m=e.teams[0].uuid,n="team",c.search({uuid:e.teams[0].uuid}).hash("team")),k(m),b.views={team:!0,newTeam:!1,newMember:!1,editTeam:!1},b.requestTeam=function(a,d){k(a),b.$watch(c.search(),function(){c.search({uuid:a})}),d&&("team"!=c.hash()&&c.hash("team"),o("team"))};var o=function(a){b.views={team:!1,newTeam:!1,newMember:!1,editTeam:!1},b.views[a]=!0};b.setViewTo=function(a){b.$watch(a,function(){c.hash(a),o(a)})},o(n),b.toggleSelection=function(a,c){var d=c?!0:!1,e=angular.fromJson(h.get(a.uuid));angular.forEach(e,function(a){b.selection[a.uuid]=d})},b.editTeam=function(a){b.teamEditForm={name:a.name,uuid:a.uuid},b.views.editTeam=!0},b.cancelTeamEdit=function(a){b.teamEditForm={name:a.name,uuid:a.uuid},b.views.editTeam=!1},b.changeTeam=function(c){return""==$.trim(c.name)?(a.notifier.error(a.ui.teamup.teamNamePrompt1),void 0):(a.statusBar.display(a.ui.teamup.saveTeam),d.edit(c).then(function(e){e.error?a.notifier.error("Error with saving team info : "+e.error):(a.statusBar.display(a.ui.teamup.refreshing),d.query(!1,e).then(function(){a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off(),b.team.name=c.name,b.views.editTeam=!1}))}),void 0)},b.teamSubmit=function(f){return"undefined"==typeof f||""==$.trim(f.name)?(a.notifier.error(a.ui.teamup.teamNamePrompt1),void 0):(a.statusBar.display(a.ui.teamup.saveTeam),d.save(f).then(function(f){f.error?a.notifier.error(a.ui.teamup.teamSubmitError):(a.statusBar.display(a.ui.teamup.refreshing),d.query(!1,f).then(function(d){d.error?(a.notifier.error(a.ui.teamup.queryTeamError),console.warn("error ->",d)):(a.notifier.success(a.ui.teamup.dataChanged),b.closeTabs(),b.data=d,angular.forEach(d.teams,function(a){a.uuid==f.uuid&&(b.teams=d.teams,angular.forEach(d.teams,function(c){c.uuid==a.uuid&&(b.team=c)}),b.members=e.members[a.uuid],b.current=a.uuid,b.$watch(c.search(),function(){c.search({uuid:a.uuid})}))})),a.statusBar.off()}))}),void 0)},b.memberSubmit=function(f){if("undefined"==typeof f||!f.username||!f.password||!f.reTypePassword)return a.notifier.error(a.ui.teamup.accountInfoFill),void 0;if(f.password!=f.reTypePassword)return a.notifier.error(a.ui.teamup.passNotSame),void 0;if(!f.team)return a.notifier.error(a.ui.teamup.selectTeam),void 0;a.statusBar.display(a.ui.teamup.savingMember);var g={uuid:f.username,userName:f.username,passwordHash:i(f.password),firstName:f.firstName,lastName:f.lastName,phone:f.phone,teamUuids:[f.team],role:f.role,birthDate:j.convert.absolute(f.birthDate,0)};d.saveMember(g).then(function(f){if(f.error)a.notifier.error(a.ui.teamup.teamSubmitError+" : "+f.error);else{a.statusBar.display(a.ui.teamup.refreshing);var g={uuid:f.teamId};d.query(!1,g).then(function(d){d.error?(a.notifier.error(a.ui.teamup.queryTeamError),console.warn("error ->",d)):(a.notifier.success(a.ui.teamup.dataChanged),b.closeTabs(),b.data=d,angular.forEach(d.teams,function(a){a.uuid==g.uuid&&(b.teams=d.teams,angular.forEach(d.teams,function(c){c.uuid==a.uuid&&(b.team=c)}),b.members=e.members[a.uuid],b.current=a.uuid,b.$watch(c.search(),function(){c.search({uuid:a.uuid})}))})),a.statusBar.off()})}})},b.closeTabs=function(){b.teamForm={},b.memberForm={},b.setViewTo("team")},b.editProfile=function(a,b){sessionStorage.setItem(a+"_team",b)},b.noSharedStates=function(a){var b=!0,c=!0;return angular.forEach(a,function(a){a.share&&b&&(c=!1,b=!1)}),c},b.deleteTeam=function(){console.log(b.current),window.confirm(a.ui.teamup.delTeamConfirm)&&(a.statusBar.display(a.ui.teamup.deletingTeam),d.deleteTeam(b.current).then(function(c){c&&d.query(!0,{}).then(function(e){b.requestTeam(e[0].uuid),angular.forEach(b.teams,function(a,d){a.uuid==c&&b.teams.splice(d,1)}),d.queryMembersNotInTeams().then(function(){console.log("members not in any teams loaded "),a.statusBar.off()},function(a){console.log(a)})},function(a){console.log(a)}),a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off()},function(a){console.log(a)}))},b.deleteMember=function(c){window.confirm(a.ui.teamup.deleteConfirm)&&(a.statusBar.display(a.ui.teamup.deletingMember),d.deleteMember(c).then(function(f){f.uuid&&(a.notifier.success(a.ui.teamup.dataChanged),angular.forEach(b.members,function(b){b.uuid==c&&angular.forEach(b.teamUuids,function(b){a.statusBar.display(a.ui.teamup.refreshing);var f={uuid:b};d.query(!1,f).then(function(){a.statusBar.off()}),angular.forEach(e.members[b],function(a,d){a.uuid==c&&e.members[b].splice(d,1)})})}),d.queryMembersNotInTeams().then(function(){console.log("members not in any teams loaded "),a.statusBar.off()},function(a){console.log(a)}))},function(a){console.log(a)}))};var p=profile.host()+profile.ns()+"/team/member/"+a.app.resources.uuid+"/photourl";d.loadImg(p).then(function(b){var c=a.app.resources.uuid,d=c.replace(".","").replace("@","");if(!b.status||404!=b.status&&403!=b.status&&500!=b.status){if(b.path){var e=profile.host().replace("\\:",":")+b.path;$(".navbar-inner #img_"+d).css("background-image",'url("'+e+'")')}}else console.log("no pics ",b)},function(a){console.log("error when load pic "+a)})}]),angular.module("WebPaige.Controllers.Clients",[]).controller("clientCtrl",["$rootScope","$scope","$location","Clients","data","$route","$routeParams","Storage","Dater","$filter","$modal","Teams",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){if(angular.forEach(e.clientGroups,function(c){c.id==a&&(b.clientGroup=c)}),b.clients=e.clients[a],b.current=a,b.views.reports&&(b.currentCLient="0",b.currentMonth="0",t()),b.views.client&&angular.forEach(b.clients,function(a){var c=b.imgHost+b.ns+"/client/"+a.uuid+"/photourl";d.loadImg(c).then(function(c){var d=a.uuid.replace(".","").replace("@","");if(!c.status||404!=c.status&&403!=c.status&&500!=c.status){if(c.path){var e=b.imgHost+c.path;$("#img_"+d).css("background-image","url("+e+")")}}else console.log("loading pic ",c)},function(a){console.log("error when load pic "+a)})}),b.views.viewClient){var c=b.imgHost+b.ns+"/client/"+b.client.uuid+"/photourl";d.loadImg(c).then(function(a){var c=b.client.uuid.replace(".","").replace("@","");if(!a.status||404!=a.status&&403!=a.status&&500!=a.status){if(a.path){var d=b.imgHost+a.path;$("#viewClientTab #img_"+c).css("background-image","url("+d+")")}}else console.log("loading pic ",a)},function(a){console.log("error when load pic "+a)})}}a.fixStyles(),e.clientId&&(e.clientGroups=angular.fromJson(h.get("ClientGroups")),e.clients={},angular.forEach(e.clientGroups,function(a){{var c=angular.fromJson(h.get(a.id));a.id}e.clients[a.id]=c,angular.forEach(c,function(a){a.uuid==e.clientId&&(b.client=a,b.contacts=a.contacts,a.birthDate=j("nicelyDate")(a.birthDate),b.clientmeta=a)})})),b.clients=e.clients,b.clientGroups=e.clientGroups;var n=i.getMonthTimeStamps();b.Months=[],angular.forEach(n,function(a,c){var d={number:c,name:c,start:a.first.timeStamp,end:a.last.timeStamp};b.Months[c]=d}),b.Months[0]={number:0,name:a.ui.teamup.selectMonth};var o=c.search();b.imgHost=profile.host(),b.ns=profile.ns(),b.search={query:""},b.selection={},b.data=e;var p,q;o.uuid||c.hash()?o.uuid?(p=o.uuid,"undefined"==typeof p&&(p=b.client.clientGroupUuid),q=c.hash()):(p=e.clientGroups[0].id,q=c.hash(),c.search({uuid:e.clientGroups[0].id})):(p=e.clientGroups[0].id,q="client",c.search({uuid:e.clientGroups[0].id}).hash("client")),b.views={client:!0,newClientGroup:!1,newClient:!1,reports:!1,editClientGroup:!1,editClient:!1,viewClient:!1,editImg:!1};var r=function(a){b.views={client:!1,newClientGroup:!1,newClient:!1,reports:!1,editImg:!1},"viewClient"==a&&s(),"reports"==a&&t(),b.views[a]=!0},s=function(){a.statusBar.display(a.ui.teamup.loadingReports),d.queryReports(b.client.uuid).then(function(c){a.statusBar.off(),b.reports=b.processReports(c),b.$watch(b.reports,function(a){console.log("watcher found ... ",a),b.loadMembersImg()})},function(a){console.log(a)})},t=function(){a.statusBar.display(a.ui.teamup.loadingReports),d.queryGroupReports(b.clientGroup.id).then(function(c){a.statusBar.off(),b.groupReports=b.processReports(c),0!=b.currentCLient&&b.requestReportsByFilter(),b.$watch(b.groupReports,function(a){console.log("watcher found ... ",a),b.loadMembersImg()})},function(a){console.log(a)})};b.loadMembersImg=function(){var a=[];angular.forEach(b.groupReports,function(b){-1==a.indexOf(b.author.uuid)&&a.add(b.author.uuid)}),angular.forEach(b.reports,function(b){-1==a.indexOf(b.author.uuid)&&a.add(b.author.uuid)}),angular.forEach(a,function(a){var c=b.imgHost+b.ns+"/team/member/"+a+"/photourl";l.loadImg(c).then(function(c){var d=a.replace(".","").replace("@","");if(!c.status||404!=c.status&&403!=c.status&&500!=c.status){if(c.path){var e=b.imgHost+c.path;$(".tab-content #img_"+d).css("background-image","url("+e+")")}}else console.log("no pics ",c)},function(a){console.log("error when load pic "+a)})})},r(q),m(p),b.requestClientGroup=function(a,d){m(a),b.$watch(c.search(),function(){c.search({uuid:a})}),d&&("client"!=c.hash()&&c.hash("client"),r("client"))},b.processReports=function(a){var c=[];return angular.forEach(a,function(a){var d={uuid:a.uuid,title:a.title,creationTime:a.creationTime,clientUuid:a.clientUuid,body:a.body,author:b.$root.getTeamMemberById(a.authorUuid),client:b.$root.getClientByID(a.clientUuid),filtered:"false"};c.add(d)}),c},b.setViewTo=function(a){b.$watch(a,function(){b.clientGroup||(b.clientGroup=b.clientGroups[0]),"viewClient"!=c.hash()&&"editClient"!=c.hash()&&"editImg"!=c.hash()||"client"!=a||c.path("/client").search({uuid:b.clientGroup.id}),c.hash(a),r(a)})},b.editClientGroup=function(a){b.cGroupEditForm={name:a.name,id:a.id},b.views.editClientGroup=!0},b.cancelClientGroupEdit=function(a){b.cGroupEditForm={name:a.name,id:a.id},b.views.editClientGroup=!1},b.changeClientGroup=function(c){return""==$.trim(c.name)?(a.notifier.error(a.ui.teamup.cGroupNamePrompt1),void 0):(a.statusBar.display(a.ui.teamup.saveClientGroup),d.edit(c).then(function(e){e.error?a.notifier.error("Error with saving client Group info"):(a.statusBar.display(a.ui.teamup.refreshing),d.query(!1).then(function(){a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off(),b.clientGroup.name=c.name,b.views.editClientGroup=!1}))}),void 0)};var u=function(e){d.query(!1,e).then(function(d){d.error?(a.notifier.error(a.ui.teamup.queryCGroupError),console.warn("error ->",d)):(a.notifier.success(a.ui.teamup.dataChanged),b.closeTabs(),b.data=d,b.clientGroups=d.clientGroups,b.clients=d.clients,angular.forEach(d.clientGroups,function(a){a.id==e.uuid&&(b.clientGroup=a,b.current=a.id,b.$watch(c.search(),function(){c.search({id:a.id})}))})),a.statusBar.off()})};b.cGroupSubmit=function(b){return"undefined"==typeof b||""==$.trim(b.name)?(a.notifier.error(a.ui.teamup.teamNamePrompt1),void 0):(a.statusBar.display(a.ui.teamup.saveClientGroup),d.saveGroup(b).then(function(b){if(b.error)a.notifier.error(a.ui.teamup.cGroupSubmitError);else{a.statusBar.display(a.ui.teamup.refreshing);var c={uuid:b.id};u(c)}}),void 0)},b.closeTabs=function(){b.clientGroupForm={},b.clientForm={},r("client")},b.addContacts=function(){if("undefined"==typeof b.contactForm||""==b.contactForm.func)return a.notifier.error(a.ui.teamup.teamNamePrompt2),void 0;var c={firstName:"",lastName:"","function":"",phone:""};c.firstName=b.contactForm.firstName,c.lastName=b.contactForm.lastName,c.function=b.contactForm.function,c.phone=b.contactForm.phone,"undefined"==typeof b.contacts&&(b.contacts=[]),null==b.contacts&&(b.contacts=[]),b.contacts.push(c)},b.clientSubmit=function(c){if("undefined"==typeof c||!c.firstName||!c.lastName||!c.phone)return a.notifier.error(a.ui.teamup.clinetInfoFill),void 0;a.statusBar.display(a.ui.teamup.savingClient);try{c.birthDate=i.convert.absolute(c.birthDate,0)}catch(e){return console.log(e),a.notifier.error(a.ui.teamup.birthdayError),void 0}c.clientGroupUuid=b.clientGroup.id,d.save(c).then(function(b){if(b.error)a.notifier.error(a.ui.teamup.clientSubmitError);else{var c={uuid:b.clientGroupUuid};u(c)}})},b.clientChange=function(b){a.statusBar.display(a.ui.teamup.savingClient);try{b.birthDate=i.convert.absolute(b.birthDate,0)}catch(c){return console.log(c),a.notifier.error(a.ui.teamup.birthdayError),void 0}d.updateClient(b).then(function(b){if(b.error)a.notifier.error(a.ui.teamup.clientSubmitError);else{a.statusBar.display(a.ui.teamup.refreshing),a.notifier.success(a.ui.teamup.dataChanged);var c={uuid:b.clientGroupUuid};u(c)}})},b.saveContacts=function(c){console.log("client id ",b.client.uuid),console.log("contacts ",c);var e=b.client;try{e.birthDate=i.convert.absolute(e.birthDate,0)}catch(f){return console.log(f),a.notifier.error(a.ui.teamup.birthdayError),void 0}e.contacts=c,a.statusBar.display(a.ui.teamup.savingContacts),d.updateClient(e).then(function(c){if(c.error)a.notifier.error(a.ui.teamup.clientSubmitError);else{a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off();var e={uuid:c.clientGroupUuid};d.query(!1,e).then(function(){})}b.client.birthDate=j("nicelyDate")(b.client.birthDate)})},b.removeContact=function(a){angular.forEach(b.contacts,function(c,d){a.name==c.name&&a.func==c.func&&a.phone==c.phone&&b.contacts.splice(d,1)})},b.deleteClientGroup=function(){window.confirm(a.ui.teamup.delClientGroupConfirm)&&(a.statusBar.display(a.ui.teamup.deletingClientGroup),d.deleteClientGroup(b.current).then(function(c){c.id&&d.query(!0,{}).then(function(a){b.requestClientGroup(a[0].id),angular.forEach(b.clientGroups,function(a,d){a.id==c.id&&b.clientGroups.splice(d,1)
})},function(a){console.log(a)}),a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off()},function(a){console.log(a)}))},b.deleteClient=function(c){window.confirm(a.ui.teamup.deleteConfirm)&&(a.statusBar.display(a.ui.teamup.deletingClient),angular.forEach(b.clients,function(a){if(a.uuid==c){var e=a.clientGroupUuid;(null==e||""==e)&&(e=b.clientGroup.id);var g={},h=[],i=[];h.add(c),g[e]={a:i,r:h},null!=e&&""!=e&&e!=b.clientGroup.id&&(g[b.clientGroup.id]={a:i,r:h}),d.manage(g).then(function(){d.deleteClient(c).then(function(){d.queryAll().then(function(){1==b.views.viewClient?b.setViewTo("client"):f.reload()})},function(a){console.log(a)})})}}))},b.requestReportsByFilter=function(){angular.forEach(b.groupReports,function(a){a.filtered=a.clientUuid!=b.currentCLient&&"0"!=b.currentCLient?"true":"false";var c=new Date(a.creationTime).getMonth()+1;a.filtered=c!=b.currentMonth&&"0"!=b.currentMonth||"true"==a.filtered?"true":"false"}),b.loadMembersImg()};var v=function(b,c,e){b.report=e,b.view={editReport:e.editMode?!0:!1,viewReport:e.editMode||"undefined"==typeof e.uuid?!1:!0,newReport:"undefined"==typeof e.uuid?!0:!1},b.close=function(){c.dismiss()},b.saveReport=function(b){console.log("save report"),console.log(d);var e={uuid:b.uuid,title:b.title,body:b.body,creationTime:b.creationTime};d.saveReport(b.clientUuid,e).then(function(){c.close(b),a.notifier.success(a.ui.teamup.dataChanged)})}};b.openReport=function(a){b.report=a,b.report.editMode=!1;k.open({templateUrl:"./js/views/reportTemplate.html",controller:v,resolve:{report:function(){return b.report}}})},b.newReport=function(){if(0==b.currentCLient)return a.notifier.error(a.ui.teamup.selectClient),void 0;var c={title:a.ui.teamupnewReport,creationTime:(new Date).getTime(),clientUuid:b.currentCLient,body:null,author:b.$root.getTeamMemberById(a.app.resources.uuid),client:b.$root.getClientByID(b.currentCLient),editMode:!1};b.report=c;var d=k.open({templateUrl:"./js/views/reportTemplate.html",controller:v,resolve:{report:function(){return b.report},editMode:!1}});d.result.then(function(){console.log("Modal close at: "+new Date),t()},function(){console.log("Modal dismissed at: "+new Date)})},b.editReport=function(a){b.report=a,b.report.editMode=!0;k.open({templateUrl:"./js/views/reportTemplate.html",controller:v,resolve:{report:function(){return b.report}}})},b.removeReport=function(b){window.confirm(a.ui.teamup.deleteConfirm)&&(a.statusBar.display(a.ui.teamup.loading),d.removeReport(b.clientUuid,b.uuid).then(function(b){console.log(b),"ok"==b.result?(a.notifier.success(a.ui.teamup.dataChanged),t()):a.notifier.error(b.error)},function(a){console.log(a)}))},b.editImg=function(){a.statusBar.display(a.ui.profile.loadUploadURL),b.uploadURL=b.imgHost+b.ns+"/client/"+b.client.uuid+"/photourl",d.loadImg(b.uploadURL).then(function(c){a.statusBar.off();var d=b.imgHost.replace("\\:",":");c.path&&(b.avatarURL=d+c.path),b.uploadURL=d+b.ns+"/client/"+b.client.uuid+"/photo",b.setViewTo("editImg")})}}]),angular.module("WebPaige.Controllers.Manage",[]).controller("manageCtrl",["$rootScope","$scope","$location","Clients","$route","$routeParams","Storage","Teams","$window","data",function(a,b,c,d,e,f,g,h,i,j){function k(a){b.views={teamClients:!1,teams:!1,clients:!1},b.views[a]=!0;var c=b.loadData(j);j=c.data,m=c.con}b.loadData=function(a){if(a&&a.local){var c=angular.fromJson(g.get("Teams")),d={teamClients:{},teams:{},clients:{}},e=[];a.teams=[];var f=[];angular.forEach(c,function(b){a.teams.push({id:b.uuid,name:b.name});var c=angular.fromJson(g.get(b.uuid)),h=[];angular.forEach(c,function(a){h.push(a.uuid),-1==f.indexOf(a.uuid)&&(e.push({name:a.firstName+" "+a.lastName,id:a.uuid}),f.push(a.uuid))}),d.teams[b.uuid]=h});var h=angular.fromJson(g.get("members"));angular.forEach(h,function(a){-1==f.indexOf(a.uuid)&&e.push({name:a.firstName+" "+a.lastName,id:a.uuid})}),a.members=e;var i=angular.fromJson(g.get("ClientGroups")),j=[];a.groups=i;var k=[],l=[];angular.forEach(i,function(a){var b=angular.fromJson(g.get(a.id)),c=[];angular.forEach(b,function(a){c.push(a.uuid),-1==l.indexOf(a.uuid)&&(l.push(a.uuid),k.push({name:a.firstName+" "+a.lastName,id:a.uuid}))}),d.clients[a.id]=c,j.push(a.id)});var m=angular.fromJson(g.get("clients"));return angular.forEach(m,function(a){-1==l.indexOf(a.uuid)&&(l.push(a.uuid),k.push({name:a.firstName+" "+a.lastName,id:a.uuid}))}),a.clients=k,angular.forEach(c,function(a){var b=angular.fromJson(g.get("teamGroup_"+a.uuid)),c=!0;angular.forEach(b,function(b){-1!=j.indexOf(b.id)&&c&&(d.teamClients[a.uuid]=b.id,c=!1)})}),b.connections=d,{data:a,con:d}}return{data:{},con:{}}};var l=b.loadData(j);j=l.data;var m=l.con;b.data={left:[],right:[]},b.setViewTo=function(d){return"undefined"!=typeof b.dataChanged&&b.dataChanged(c.$$hash)&&!confirm(a.ui.teamup.managePanelchangePrompt)?(event.preventDefault(),!1):(b.$watch(d,function(){c.hash(d),k(d),b.manage(d)}),void 0)},b.setViewTo("teamClients"),b.connector={data:m,connections:{teamClients:[],teams:{},clients:{}},teamClients:function(){this.connections.teamClients=[];var a=this;return angular.forEach(this.data.teamClients,function(b,c){var d={sourceItems:[],targetItem:{}};angular.forEach(j.teams,function(a){a.id==c&&(d.targetItem=a)});for(var e,f=0;f<j.groups.length;f++)j.groups[f].id==b&&(e=j.groups[f],d.sourceItems.push(e));a.connections.teamClients.push(d)}),this.connections},populate:function(a,b,c){var d={};return angular.forEach(a,function(a,e){d[e]=[],angular.forEach(a,function(a){angular.forEach(b,function(b){b.id==a&&d[e].push({_id:b.id,name:b.name,_parent:c+e})})})}),d},teams:function(){return this.connections.teams={},this.connections.teams=this.populate(this.data.teams,j.members,"teams_right_"),this.connections},clients:function(){return this.connections.clients={},this.connections.clients=this.populate(this.data.clients,j.clients,"clients_right_"),this.connections}},b.manage=function(c){switch(c){case"teamClients":a.$broadcast("TreeGridManager",c,"1:1",{left:j.groups,right:j.teams},b.connector.teamClients());break;case"teams":a.$broadcast("TreeGridManager",c,"1:n",{left:j.members,right:j.teams},b.connector.teams());break;case"clients":a.$broadcast("TreeGridManager",c,"1:n",{left:j.clients,right:j.groups},b.connector.clients())}},b.getChanges=function(a,b){var c={};return angular.forEach(a,function(a,d){var e=[],f=b[d];angular.forEach(a,function(a){angular.forEach(f,function(b){a==b&&e.push(a)})}),angular.forEach(e,function(b){a.splice(a.indexOf(b),1),f.splice(f.indexOf(b),1)});var g=[],h=[];angular.copy(a,h),angular.copy(f,g),(g.length>0||g.length>0||h.length>0||h.length>0)&&(c[d]={a:g,r:h}),angular.forEach(e,function(b){a.push(b),f.push(b)})}),c},a.$$listeners["save:teamClients"]&&a.$$listeners["save:teamClients"].length>0&&(a.$$listeners["save:teamClients"]=[]),a.$$listeners["save:teams"]&&a.$$listeners["save:teams"].length>0&&(a.$$listeners["save:teams"]=[]),a.$$listeners["save:clients"]&&a.$$listeners["save:clients"].length>0&&(a.$$listeners["save:clients"]=[]),b.getChangesFromTeamClients=function(a){console.log("before changing ->",b.connections.teamClients),console.log("saving team clients ->",a);var c=b.connections.teamClients,d=a,e=[];angular.forEach(c,function(a,b){-1==e.indexOf(b)&&e.push(b)}),angular.forEach(d,function(a,b){-1==e.indexOf(b)&&e.push(b)});var f={};return angular.forEach(e,function(a){"undefined"==typeof c[a]&&d[a]?f[a]={a:[d[a]],r:[]}:"undefined"==typeof d[a]&&c[a]?f[a]={r:[c[a]],a:[]}:c[a]&&d[a]&&c[a]!=d[a]&&(f[a]={a:[d[a]],r:[c[a]]})}),f},b.applyTeamClientsChanges=function(b){a.statusBar.display(a.ui.teamup.refreshing),h.manageGroups(b).then(function(b){var c="";angular.forEach(b,function(a){a.error&&(c+=a.error.data.error)}),""==c?(a.notifier.success(a.ui.teamup.dataChanged),e.reload()):a.notifier.error(c),a.statusBar.off()})},a.$on("save:teamClients",function(){var a=b.getChangesFromTeamClients(arguments[1]);angular.equals({},a)?console.log("no changes ! "):(console.log("Team Groups changes : ",a),b.applyTeamClientsChanges(a))}),b.applyTeamsChanges=function(b){a.statusBar.display(a.ui.teamup.refreshing),h.manage(b).then(function(){a.notifier.success(a.ui.teamup.dataChanged),h.queryMembersNotInTeams().then(function(){console.log("members not in any teams loaded "),a.statusBar.off(),e.reload()},function(a){console.log(a)})})},a.$on("save:teams",function(){console.log("before teams -> ",b.connections.teams),console.log("saving teams ->",arguments[1]);var a=b.connections.teams,c=arguments[1],d=b.getChanges(a,c);angular.equals({},d)?console.log("no changes ! "):(console.log("Team Member changes : ",d),b.applyTeamsChanges(d))}),a.$on("save:clients",function(){console.log("before clients -> ",b.connections.clients),console.log("saving clients ->",arguments[1]);var c=b.connections.clients,f=arguments[1],g=b.getChanges(c,f);console.log("Group Client changes : ",g),angular.equals({},g)?console.log("no changes ! "):(a.statusBar.display(a.ui.teamup.refreshing),d.manage(g).then(function(){a.notifier.success(a.ui.teamup.dataChanged),a.statusBar.off(),e.reload()}))}),b.dataChanged=function(a){var c=a.split("#"),d=c[c.length-1],e={};if("teamClients"==d){var f=b.$$childTail.getData.teamClients();e=b.getChangesFromTeamClients(f)}else if("teams"==d){var g=b.connections.teams,h=b.$$childTail.getData.teams();e=b.getChanges(g,h)}else if("clients"==d){var i=b.connections.clients,j=b.$$childTail.getData.clients();e=b.getChanges(i,j)}return console.log(e),angular.equals({},e)?(console.log("no changes ! "),!1):!0}}]),angular.module("WebPaige.Controllers.TreeGrid",[]).controller("treegrid",["$rootScope","$scope","$window",function(a,b,c){b.treeGrid={options:{grid:{width:"auto",height:null,items:{minHeight:40}}},type:null,grid:null,data:{},processed:{},grids:{},stores:{},caches:{},connections:{},areas:function(){this.options.grid.height=$("#wrap").height()-470+"px"},build:function(a,c){var d=this,e=b.treeGrid.grid+"_"+a;this.grids[e]=new links.TreeGrid(document.getElementById(b.treeGrid.grid+"_"+a),this.options.grid),angular.forEach(this.stores,function(a){var b=[];angular.forEach(a.data,function(a){a._id&&b.push(a)}),a.data=a.filteredData=b}),this.grids[e].draw(this.store(a,c)),links.events.addListener(this.grids[e],"expand",function(a){console.log("expanding ->",e,a)}),links.events.addListener(this.grids[e],"collapse",function(a){console.log("collapsing ->",e,a)}),links.events.addListener(this.grids[e],"select",function(a){console.log("selecting ->",e,a)}),links.events.addListener(this.grids[e],"remove",function(a){for(var b=a.items,c=0;c<b.length;c++)d.stores[e].removeLink(b[c])})},store:function(a,c){var d=this,e=b.treeGrid.grid+"_"+a;return this.stores[e]=new links.DataTable(this.process(a,c),this.configure(a)),this.stores[e].totalItems=this.stores[e].data.length,this.stores[e].appendItems=function(a,b){function c(a,b){for(var c=!0,d=0;d<b.length;d++)a._id==b[d]._id&&(c=!1);return a.nodes&&(c=!1),c}for(var d=0;d<a.length;d++){var e=c(a[d],this.data);e&&(a[d]._actions=[{event:"remove",text:"remove"}],this.data.push(a[d]))}e&&(this.updateFilters(),b&&b({totalItems:this.filteredData.length,items:a}),this.trigger("change",void 0))},this.stores[e].linkItems=function(a,b,c,d){var e=this.data.indexOf(b);if(-1==e)return d("Error: targetItem not found in data"),void 0;for(var f=[],g=[],h=0;h<a.length;h++)f.push(a[h].name),g.push(a[h]._id);this.data[e]={_id:b._id,name:b.name,links:f.join(", "),_ids:g.join(", "),_actions:[{event:"unlink",text:"unlink"}]},c({items:[b],totalItems:this.data.length}),this.update()},this.stores[e].unlink=function(a){var b=this.data.indexOf(a);if(-1==b)throw Error("item not found in data");this.data[b]={_id:a._id,name:a.name},this.update()},this.stores[e].removeLink=function(a){var b=[];angular.forEach(d.stores[a._parent].data,function(c){c._id!=a._id&&b.push(c)}),d.stores[a._parent].data=d.stores[a._parent].filteredData=b,this.updateFilters(),this.trigger("change",void 0);var c=[],e=a._parent.split("_"),f=e[0],g=e[e.length-1];angular.forEach(d.connections[f][g],function(b){b._id!=a._id&&(b._actions=[{event:"remove",text:"remove"}],c.push(b))}),d.connections[f][g]=d.caches[a._parent]=c,this.update()},links.events.addListener(this.stores[e],"change",function(){angular.forEach(d.stores[e].data,function(a){a._parent=e}),d.caches[e]=d.stores[e].data}),links.events.addListener(this.stores[e],"unlink",function(a){for(var b=a.items,c=0;c<b.length;c++)d.stores[e].unlink(b[c])}),"teamClients"==b.treeGrid.grid&&"right"==a&&this.connections.teamClients.length>0&&angular.forEach(this.connections.teamClients,function(a){var b;angular.forEach(d.stores.teamClients_right.data,function(c,e){if(a.targetItem.id==c._id){b=e;for(var f=[],g=[],h=0;h<a.sourceItems.length;h++)f.push(a.sourceItems[h].name),g.push(a.sourceItems[h].id);d.stores.teamClients_right.data[b]={_id:a.targetItem.id,name:a.targetItem.name,links:f.join(", "),_ids:g.join(", "),_actions:[{event:"unlink",text:"unlink"}]},d.stores.teamClients_right.update()}})}),this.stores[e]},process:function(a,c){var d=this,e=b.treeGrid.grid+"_"+a,f=[];return angular.forEach(c,function(a){a.id&&f.push(a)}),this.processed[e]=[],angular.forEach(f,function(b){var c=d.grid+"_"+a+"_"+b.id,f={name:b.name,_id:b.id,_parent:c};if("1:n"==d.type&&"right"==a){"teams"==d.grid&&d.connections.teams[b.id]&&d.connections.teams[b.id].length>0&&setTimeout(function(){d.stores[c].appendItems(d.connections.teams[b.id],function(a){d.stores[c].totalItems=a.totalItems})},100),"clients"==d.grid&&d.connections.clients[b.id]&&d.connections.clients[b.id].length>0&&setTimeout(function(){d.stores[c].appendItems(d.connections.clients[b.id],function(a){d.stores[c].totalItems=a.totalItems})},100);var g=d.caches[c]?d.caches[c]:[];f.nodes=d.store(a+"_"+b.id,g)}d.processed[e].push(f)}),this.processed[e]},configure:function(a){var b={showHeader:!1,dataTransfer:{}};switch(this.type){case"1:1":switch(a){case"left":b.dataTransfer={allowedEffect:"link"};break;case"right":b.dataTransfer={dropEffect:"link"}}break;case"1:n":b.dataTransfer={allowedEffect:"copy",dropEffect:"copy"}}return b},init:function(){this.areas(),this.build("left",this.data.left),this.build("right",this.data.right)}},a.$on("TreeGridManager",function(){b.treeGrid.grid=arguments[1],b.treeGrid.type=arguments[2],b.treeGrid.data=arguments[3],b.treeGrid.connections=arguments[4],function(a){setTimeout(function(){a.treeGrid.init()},100)}(b)}),c.onresize=function(){b.treeGrid.init()},b.extract=function(a){var b={};return angular.forEach(a,function(a){if(a.nodes.data.length>0){var c=[];angular.forEach(a.nodes.data,function(a){c.push(a._id)}),b[a._id]=c}}),b},b.save={teamClients:function(){var c=b.treeGrid.stores.teamClients_right.data,d={};angular.forEach(c,function(a){(a._ids||a.links)&&(d[a._id]=a._ids)}),a.$broadcast("save:teamClients",d)},teams:function(){a.$broadcast("save:teams",b.extract(b.treeGrid.stores.teams_right.data))},clients:function(){a.$broadcast("save:clients",b.extract(b.treeGrid.stores.clients_right.data))}},b.getData={teamClients:function(){var a=b.treeGrid.stores.teamClients_right.data,c={};return angular.forEach(a,function(a){(a._ids||a.links)&&(c[a._id]=a._ids)}),c},teams:function(){return b.extract(b.treeGrid.stores.teams_right.data)},clients:function(){return b.extract(b.treeGrid.stores.clients_right.data)}}}]),angular.module("WebPaige.Controllers.Planboard",[]).controller("planboard",["$rootScope","$scope","$location","Dater","Storage","Teams","Clients",function(a,b,c,d,e,f,g){function h(){switch(b.section){case"teams":b.list=b.data.teams.list,"undefined"==typeof b.currentTeam&&(b.currentTeam=b.data.teams.list[0].uuid),b.changeCurrent(b.currentTeam);break;case"clients":b.list=b.data.clients.list,"undefined"==typeof b.currentClientGroup&&(b.currentClientGroup=b.data.clients.list[0].uuid),b.changeCurrent(b.currentClientGroup)}}function i(a){b.views={teams:!1,clients:!1,member:!1,slot:{add:!1,edit:!1}},b.views[a]=!0}var j=c.search();b.imgHost=profile.host(),b.ns=profile.ns();var k=angular.fromJson(e.get("Teams")),l=angular.fromJson(e.get("ClientGroups"));b.data={teams:{list:[],members:{},tasks:[]},clients:{list:[],members:{},tasks:[]},user:[{count:0,end:1378681200,recursive:!0,start:1378504800,text:"com.ask-cs.State.Available",type:"availability",wish:0},{count:0,end:1378850400,recursive:!0,start:1378720800,text:"com.ask-cs.State.Available",type:"availability",wish:0}],members:[],synced:Number(Date.today()),periods:{start:Number(Date.today())-6048e5,end:Number(Date.today())+6048e5}},angular.forEach(k,function(a){var c=angular.fromJson(e.get(a.uuid));c&&c.length>0&&(b.data.teams.list.push({uuid:a.uuid,name:a.name}),b.data.teams.members[a.uuid]=[],angular.forEach(c,function(c){var d=e.avatar.geturl(c.uuid),f=b.imgHost+d;"undefined"==typeof d&&(f=profile.noImgURL);var g='<div class="roundedPicSmall memberStateNone" style="float: left; background-image: url('+f+');" memberId="'+c.uuid+'"></div>',h=g+'<div style="float: left; margin: 15px 0 0 5px; font-size: 14px;">'+c.firstName+" "+c.lastName+"</div>",i={head:h,memId:c.uuid};b.data.teams.members[a.uuid].push(i)}))}),angular.forEach(l,function(a){var c=angular.fromJson(e.get(a.id));c&&c.length>0&&(b.data.clients.list.push({uuid:a.id,name:a.name}),b.data.clients.members[a.id]=[],angular.forEach(c,function(c){var d=e.avatar.geturl(c.uuid),f=b.imgHost+d;"undefined"==typeof d&&(f=profile.noImgURL);var g='<div class="roundedPicSmall memberStateNone" style="float: left; background-image: url('+f+');" memberId="'+c.uuid+'"></div>',h=g+'<div style="float: left; margin: 15px 0 0 5px; font-size: 14px;">'+c.firstName+" "+c.lastName+"</div>",i={head:h,memId:c.uuid};b.data.clients.members[a.id].push(i)}))}),b.changeCurrent=function(d){angular.forEach(b.data[b.section].list,function(a){a.uuid==d&&(b.currentName=a.name)}),"teams"==b.section?(b.currentTeam=d,b.data.members=b.data[b.section].members[b.currentTeam]):"clients"==b.section&&(b.currentClientGroup=d,b.data.members=b.data[b.section].members[b.currentClientGroup]),b.data.section=b.section;var e=Number(Date.today())-6048e5,h=Number(Date.today())+6048e5,i=function(c,d,e){b.data[b.section].tasks=[],angular.forEach(c,function(a){if(null!=a){var c="";"teams"==b.section&&(c=a.assignedTeamMemberUuid),"clients"==b.section&&(c=a.relatedClientUuid),"undefined"==typeof b.data[b.section].tasks[c]&&(b.data[b.section].tasks[c]=new Array),b.data[b.section].tasks[c].push(a)}}),a.$broadcast("timeliner",{start:d,end:e})};"teams"==b.data.section?(c.search({uuid:b.currentTeam}).hash("teams"),f.getTeamTasks(b.currentTeam,e,h).then(function(a){i(a,e,h)},function(a){console.log("error happend when getting the tasks for the team members "+a)})):"clients"==b.data.section&&(c.search({uuid:b.currentClientGroup}).hash("clients"),g.getClientTasks(b.currentClientGroup,e,h).then(function(a){i(a,e,h)},function(a){console.log("error happend when getting the tasks for the team members "+a)}))},b.setViewTo=function(a,d){b.$watch(d,function(){c.hash(d),b.section=d,h(),i(d)})},b.resetViews=function(){b.views.slot={add:!1,edit:!1}},a.$on("resetPlanboardViews",function(){b.resetViews()});var m,n;j.uuid||c.hash()?(m=j.uuid,n=c.hash()):(m=b.data.teams.list[0].uuid,n="teams",c.search({uuid:b.data.teams.list[0].uuid}).hash("teams")),b.setViewTo(m,n),b.self=this,b.current={layouts:{user:!0,group:!1,members:!1},day:d.current.today()+1,week:d.current.week(),month:d.current.month(),division:"all"},d.registerPeriods(),b.periods=d.getPeriods(),b.slot={};var o=d.current.today()-7<1?1:d.current.today()-7;b.timeline={id:"mainTimeline",main:!0,user:{id:a.app.resources.uuid,role:a.app.resources.role},current:b.current,options:{start:b.periods.days[o].last.day,end:b.periods.days[d.current.today()+7].last.day,min:b.periods.days[o].last.day,max:b.periods.days[d.current.today()+7].last.day},range:{start:b.periods.days[o].last.day,end:b.periods.days[d.current.today()+7].last.day},scope:{day:!1,week:!0,month:!1},config:{bar:a.config.timeline.config.bar,layouts:a.config.timeline.config.layouts,wishes:a.config.timeline.config.wishes,legenda:{},legendarer:a.config.timeline.config.legendarer,states:a.config.timeline.config.states,divisions:a.config.timeline.config.divisions,densities:a.config.timeline.config.densities}},$.browser.msie&&"8.0"==$.browser.version&&(b.timeline.options={start:b.periods.days[d.current.today()-7].last.timeStamp,end:b.periods.days[d.current.today()+7].last.timeStamp,min:b.periods.days[d.current.today()-7].last.timeStamp,max:b.periods.days[d.current.today()+7].last.timeStamp}),angular.forEach(a.config.timeline.config.states,function(a,c){b.timeline.config.legenda[c]=!0}),b.timeline.config.legenda.groups={more:!0,even:!0,less:!0},b.daterange=d.readable.date(b.timeline.range.start)+" / "+d.readable.date(b.timeline.range.end),b.processRelatedUsers=function(c){var d=[],e=$(c.group).attr("memberId");if(b.views.teams){b.relatedUserLabel=a.ui.teamup.clients;var f=a.getTeamMemberById(e);"undefined"!=typeof f.teamUuids&&f.teamUuids.length>0&&(d=a.getClientsByTeam(f.teamUuids))}else if(b.views.clients){b.relatedUserLabel=a.ui.planboard.members;var g=a.getClientByID(e);"undefined"!=typeof g.clientGroupUuid&&""!=g.clientGroupUuid&&(d=a.getMembersByClient(g.clientGroupUuid))}return d},b.resetInlineForms=function(){b.slot={},b.original={},b.resetViews(),"teams"==b.section?b.changeCurrent(b.currentTeam):"clients"==b.section&&b.changeCurrent(b.currentClientGroup)}}]),angular.module("WebPaige.Controllers.Timeline",[]).controller("timeline",["$rootScope","$scope","$q","$location","$route","$window","Dater","Sloter","Slots",function(a,b,c,d,e,f,g,h,i){var j,k;b.$watch(function(){b.timeline&&b.timeline.main?(j=b.self.timeline.getVisibleChartRange(),k=g.calculate.diff(j),864e5>=k?b.timeline.scope={day:!0,week:!1,month:!1}:6048e5>k?b.timeline.scope={day:!1,week:!0,month:!1}:k>6048e5&&(b.timeline.scope={day:!1,week:!1,month:!0}),b.timeline.range={start:new Date(j.start).toString(),end:new Date(j.end).toString()},b.daterange=g.readable.date(b.timeline.range.start)+" / "+g.readable.date(b.timeline.range.end)):e.current.params.userId!=a.app.resources.uuid&&b.self.timeline&&(j=b.self.timeline.getVisibleChartRange(),b.timeline.range={start:new Date(j.start).toString(),end:new Date(j.end).toString()})}),a.$on("slotInitials",function(){b.slot={},b.slot={start:{date:(new Date).toString(a.config.formats.date),time:(new Date).toString(a.config.formats.time),datetime:(new Date).toISOString()},end:{date:(new Date).toString(a.config.formats.date),time:(new Date).addHours(1).toString(a.config.formats.time),datetime:(new Date).toISOString()},state:"com.ask-cs.State.Available",recursive:!1,id:""}}),b.timeliner={init:function(){b.self.timeline=new links.Timeline(document.getElementById(b.timeline.id)),links.events.addListener(b.self.timeline,"rangechanged",this.getRange),links.events.addListener(b.self.timeline,"add",this.onAdd),links.events.addListener(b.self.timeline,"delete",this.onRemove),links.events.addListener(b.self.timeline,"change",this.onChange),links.events.addListener(b.self.timeline,"select",this.onSelect),this.render(b.timeline.options)},getRange:function(){b.timelineGetRange()},onAdd:function(){b.timelineOnAdd()},onRemove:function(){b.timelineOnRemove()},onChange:function(){b.timelineChanging()},onSelect:function(){b.timelineOnSelect()},render:function(c,e){var f,g;if(b.timeline.range?(typeof b.timeline.range.start!=Date&&(b.timeline.range.start=new Date(b.timeline.range.start)),typeof b.timeline.range.end!=Date&&(b.timeline.range.end=new Date(b.timeline.range.end)),f=b.timeline.range.start,g=b.timeline.range.end):(f=new Date(c.start),g=new Date(c.end)),b.timeline={id:b.timeline.id,main:b.timeline.main,user:b.timeline.user,current:b.timeline.current,scope:b.timeline.scope,config:b.timeline.config,options:{start:e?f:new Date(c.start),end:e?g:new Date(c.end),min:new Date(c.start),max:new Date(c.end)}},$.browser.msie&&"8.0"==$.browser.version&&(b.timeline.options.start=new Date(c.start),b.timeline.options.end=new Date(c.end)),angular.extend(b.timeline.options,a.config.timeline.options),b.timeline.main)b.self.timeline.draw(h.process(b.data,b.timeline.config,b.divisions,b.timeline.user.role,b.timeline.current),b.timeline.options);else{var i="timeline"==d.hash()?100:2e3;a.timelineLoaded=!1,setTimeout(function(){a.timelineLoaded=!0,a.$apply(),b.self.timeline.draw(h.profile(b.data.slots.data,b.timeline.config),b.timeline.options)},i)}b.self.timeline.setVisibleChartRange(b.timeline.options.start,b.timeline.options.end)},load:function(a,b){var c=this;c.render(a,b)},refresh:function(){b.slot={},b.timeline.main?a.$broadcast("resetPlanboardViews"):b.forms={add:!0,edit:!1},console.log("timeline refresh ->"),this.load({start:b.data.periods.start,end:b.data.periods.end},!0)},redraw:function(){b.self.timeline.redraw()},isAdded:function(){return $(".state-new").length},cancelAdd:function(){b.self.timeline.cancelAdd()}},b.timeline&&b.timeliner.init(),a.$on("timeliner",function(){b.timeliner.load({start:new Date(arguments[1].start).getTime(),end:new Date(arguments[1].end).getTime()})}),b.requestTimeline=function(a){switch(a){case"group":b.timeline.current.layouts.group=!b.timeline.current.layouts.group,b.timeline.current.layouts.members&&!b.timeline.current.layouts.group&&(b.timeline.current.layouts.members=!1);break;case"members":b.timeline.current.layouts.members=!b.timeline.current.layouts.members,b.timeline.current.layouts.members&&!b.timeline.current.layouts.group&&(b.timeline.current.layouts.group=!0)}b.timeliner.load({start:b.data.periods.start,end:b.data.periods.end})},b.timelineGetRange=function(){var a=b.self.timeline.getVisibleChartRange();b.$apply(function(){b.timeline.range={start:new Date(a.from).toString(),end:new Date(a.till).toString()},b.timeline.main&&(b.daterange={start:g.readable.date(new Date(a.start).getTime()),end:g.readable.date(new Date(a.end).getTime())})})},b.selectedSlot=function(){var c;if(b.timeliner.isAdded()>0,c=b.self.timeline.getSelection()[0]){var d=b.self.timeline.getItem(c.row),e=b.getSlotContentJSON(d.content);if(b.relatedUsers=b.processRelatedUsers(d),b.original={start:d.start,end:d.end,content:e},b.timeline.main&&"New"!=d.content?a.$broadcast("resetPlanboardViews"):"New"!=d.content&&(b.forms={add:!1,edit:!0}),"New"==d.content?e={type:"slot"}:e.clientUuid&&"undefined"==typeof e.id&&(e=$.extend(e,{type:"slot"})),e.type){if(b.timeline.main)switch(e.type){case"slot":"New"==d.content||e.relatedUser&&"undefined"==typeof e.id?b.views.slot.add=!0:b.views.slot.edit=!0;break;case"group":b.views.group=!0;break;case"wish":b.views.wish=!0;break;case"member":b.views.member=!0}var f;if(b.views.teams?f=e.clientUuid:b.views.clients&&(f=e.memberId),b.slot={start:{date:new Date(d.start).toString(a.config.formats.date),time:new Date(d.start).toString(a.config.formats.time),datetime:new Date(d.start).toISOString()},end:{date:new Date(d.end).toString(a.config.formats.date),time:new Date(d.end).toString(a.config.formats.time),datetime:new Date(d.end).toISOString()},state:e.state,recursive:e.recursive,id:e.id,memberId:e.memberId,mid:e.mid,clientUuid:e.clientUuid,relatedUser:f},b.timeline.main)switch(e.type){case"group":b.slot.diff=e.diff,b.slot.group=e.group;break;case"wish":b.slot.wish=e.wish,b.slot.group=e.group,b.slot.groupId=e.groupId;break;case"member":b.slot.member=e.mid}}return d}console.log("click the timeline , but not a slot")},b.timelineOnSelect=function(){b.$apply(function(){b.selectedOriginal=b.selectedSlot(),"undefined"!=typeof b.selectedOriginal&&b.redrawSlot(b.selectedOriginal)})},b.destroy={timeline:function(){},statistics:function(){setTimeout(function(){b.timeliner.redraw()},10)}},b.timelineOnAdd=function(c,d){if(a.planboardSync.clear(),c){var e=(Date.now().getTime(),{startTime:a.browser.mobile?new Date(d.start.datetime).getTime():g.convert.absolute(d.start.date,d.start.time,!1),endTime:a.browser.mobile?new Date(d.end.datetime).getTime():g.convert.absolute(d.end.date,d.end.time,!1),description:"undefined"==typeof d.state?"":d.state,relatedUserId:d.relatedUser});if("undefined"==typeof d.relatedUser||""==d.relatedUser)return b.views.teams?a.notifier.error(a.ui.teamup.selectClient):b.views.clients&&a.notifier.error(a.ui.teamup.selectMember),void 0;var f=b.self.timeline.getItem(b.self.timeline.getSelection()[0].row),h=$(f.group).attr("memberId");if("undefined"==typeof h)return a.notifier.error(a.ui.teamup.selectSlot),void 0;a.statusBar.display(a.ui.planboard.addTimeSlot),e=$.extend(e,{memberId:h}),e=b.convertTaskJsonObject(e),i.add(e).then(function(c){a.$broadcast("resetPlanboardViews"),c.error?(a.notifier.error(c.error.data.result),console.warn("error ->",c.error.data.result)):(a.notifier.success(a.ui.planboard.slotAdded),"teams"==b.section?b.changeCurrent(b.currentTeam):"clients"==b.section&&b.changeCurrent(b.currentClientGroup),a.statusBar.off()),b.timeliner.refresh()})}else{var e=b.self.timeline.getItem(b.self.timeline.getSelection()[0].row);b.relatedUsers=b.processRelatedUsers(e),b.timeliner.isAdded()>1&&b.self.timeline.cancelAdd(),b.$apply(function(){b.timeline.main?(a.$broadcast("resetPlanboardViews"),b.views.slot.add=!0):b.forms={add:!0,edit:!1},b.slot={start:{date:new Date(e.start).toString(a.config.formats.date),time:new Date(e.start).toString(a.config.formats.time),datetime:new Date(e.start).toISOString()},end:{date:new Date(e.end).toString(a.config.formats.date),time:new Date(e.end).toString(a.config.formats.time),datetime:new Date(e.end).toISOString()},recursive:e.group.match(/recursive/)?!0:!1,state:"com.ask-cs.State.Available"}})}},b.convertTaskJsonObject=function(c){var d,e,f;if(b.views.teams)d=c.memberId,e=c.relatedUserId,f=b.currentTeam;else if(b.views.clients){d=c.relatedUserId,e=c.memberId;var g=a.getTeamMemberById(d);f=g.teamUuids[0]}var h={uuid:c.uuid,status:1,plannedStartVisitTime:c.startTime,plannedEndVisitTime:c.endTime,relatedClientUuid:e,assignedTeamUuid:f,description:c.description,assignedTeamMemberUuid:d};return h},b.redrawSlot=function(){var c=g.convert.absolute(b.slot.start.date,b.slot.start.time,!1),d=g.convert.absolute(b.slot.end.date,b.slot.end.time,!1),e=b.self.timeline.getSelection()[0];if("undefined"!=typeof e){var f=b.processSlotContent(e.row);b.self.timeline.changeItem(e.row,{content:f,start:new Date(c),end:new Date(d)})}else alert(a.ui.teamup.selectSlot)},b.processSlotContent=function(a){var c=b.self.timeline.getItem(a),d="";angular.forEach(b.relatedUsers,function(a){a.uuid==b.slot.relatedUser&&(d=a.name)});var e=c.content;"New"!=e?(e=b.getSlotContentJSON(c.content),e.clientUuid=b.slot.clientUuid,e.memberId=b.slot.memberId):e={clientUuid:b.slot.clientUuid,memberId:b.slot.memberId};var f="<span>"+d+"</span><input type=hidden value='"+angular.toJson(e)+"'>";return("undefined"==typeof b.slot.clientUuid&&b.views.teams||"undefined"==typeof b.slot.memberId&&b.views.clients)&&("undefined"==typeof b.slot.relatedUser||""==b.slot.relatedUser)&&(f="New"),f},b.timelineChanging=function(){a.planboardSync.clear();var c=b.self.timeline.getItem(b.self.timeline.getSelection()[0].row),d=({start:c.start,end:c.end,content:c.content},b.getSlotContentJSON(c.content));b.$apply(function(){b.slot={start:{date:new Date(c.start).toString(a.config.formats.date),time:new Date(c.start).toString(a.config.formats.time),datetime:new Date(c.start).toISOString()},end:{date:new Date(c.end).toString(a.config.formats.date),time:new Date(c.end).toString(a.config.formats.time),datetime:new Date(c.end).toISOString()},state:d.state,id:d.id,memberId:d.memberId,mid:d.mid,clientUuid:d.clientUuid,relatedUser:b.slot.relatedUser}})},b.getRelatedUserId=function(a){var c="";return angular.forEach(b.relatedUsers,function(b){b.name==a&&(c=b.uuid)}),c},b.timelineOnChange=function(c,d,e,f){a.planboardSync.clear();var h=b.self.timeline.getItem(b.self.timeline.getSelection()[0].row),j=b.getSlotContentJSON(h.content),k=$(h.group).attr("memberId");if(c)var f={startTime:a.browser.mobile?new Date(e.start.datetime).getTime():g.convert.absolute(e.start.date,e.start.time,!1),endTime:a.browser.mobile?new Date(e.end.datetime).getTime():g.convert.absolute(e.end.date,e.end.time,!1),description:"",relatedUserId:e.relatedUser,uuid:j.id,memberId:k};
else var f={startTime:h.start,endTime:h.end,description:"",relatedUserId:e.relatedUser,uuid:j.id,memberId:k};var l=b.convertTaskJsonObject(f);i.update(l).then(function(c){a.$broadcast("resetPlanboardViews"),c.error?(a.notifier.error(c.error.data.result),console.warn("error ->",c)):(a.notifier.success(a.ui.planboard.slotChanged),"teams"==b.section?b.changeCurrent(b.currentTeam):"clients"==b.section&&b.changeCurrent(b.currentClientGroup)),b.timeliner.refresh(),a.statusBar.off()})},b.timelineOnRemove=function(){if(a.planboardSync.clear(),b.timeliner.isAdded()>0)b.self.timeline.cancelAdd(),b.$apply(function(){b.resetInlineForms()});else{var c=b.self.timeline.getItem(b.self.timeline.getSelection()[0].row),d=b.getSlotContentJSON(c.content),e=$(c.group).attr("memberId");if("undefined"==typeof d)return b.timeliner.refresh(),void 0;if("undefined"==typeof d.id)return console.log("Nothing to delete"),void 0;a.statusBar.display(a.ui.planboard.deletingTimeslot),i.remove(d.id,e).then(function(c){a.$broadcast("resetPlanboardViews"),c.error?(a.notifier.error(c.error.data.result),console.warn("error ->",c)):(a.notifier.success(a.ui.planboard.timeslotDeleted),"teams"==b.section?b.changeCurrent(b.currentTeam):"clients"==b.section&&b.changeCurrent(b.currentClientGroup)),b.timeliner.refresh(),a.statusBar.off(),a.planboardSync.start()})}},b.timeline&&b.timeline.main&&setTimeout(function(){b.self.timeline.redraw()},100),a.planboardSync={start:function(){f.planboardSync=f.setInterval(function(){"/planboard"==d.path()&&(b.slot={},a.$broadcast("resetPlanboardViews"),b.timeliner.load({start:b.data.periods.start,end:b.data.periods.end},!0))},6e4)},clear:function(){f.clearInterval(f.planboardSync)}},a.planboardSync.start(),b.getSlotContentJSON=function(a){var b=a.substring(a.indexOf("value=")+7,a.length-2);return angular.fromJson(b)}}]),angular.module("WebPaige.Controllers.Timeline.Navigation",[]).controller("timeline-navigation",["$rootScope","$scope","$window",function(a,b,c){b.timelineScoper=function(a){switch(b.timeline.current.day=b.current.day,b.timeline.current.week=b.current.week,b.timeline.current.month=b.current.month,a){case"day":b.timeline.scope={day:!0,week:!1,month:!1},b.timeliner.load({start:b.periods.days[b.timeline.current.day].first.timeStamp,end:b.periods.days[b.timeline.current.day].last.timeStamp});break;case"week":b.timeline.scope={day:!1,week:!0,month:!1},b.timeliner.load({start:b.periods.weeks[b.timeline.current.week].first.timeStamp,end:b.periods.weeks[b.timeline.current.week].last.timeStamp});break;case"month":b.timeline.scope={day:!1,week:!1,month:!0},b.timeliner.load({start:b.periods.months[b.timeline.current.month].first.timeStamp,end:b.periods.months[b.timeline.current.month].last.timeStamp})}},b.timelineBefore=function(){b.timeline.scope.day?1!=b.timeline.current.day&&(b.timeline.current.day--,b.timeliner.load({start:b.periods.days[b.timeline.current.day].first.timeStamp,end:b.periods.days[b.timeline.current.day].last.timeStamp})):b.timeline.scope.week?1!=b.timeline.current.week&&(b.timeline.current.week--,b.timeliner.load({start:b.periods.weeks[b.timeline.current.week].first.timeStamp,end:b.periods.weeks[b.timeline.current.week].last.timeStamp})):b.timeline.scope.month&&1!=b.timeline.current.month&&(b.timeline.current.month--,b.timeliner.load({start:b.periods.months[b.timeline.current.month].first.timeStamp,end:b.periods.months[b.timeline.current.month].last.timeStamp}))},b.timelineAfter=function(){b.timeline.scope.day?b.timeline.current.day!=b.periods.days.total&&(b.timeline.current.day++,b.timeliner.load({start:b.periods.days[b.timeline.current.day].first.timeStamp,end:b.periods.days[b.timeline.current.day].last.timeStamp})):b.timeline.scope.week?53!=b.timeline.current.week&&(b.timeline.current.week++,b.timeliner.load({start:b.periods.weeks[b.timeline.current.week].first.timeStamp,end:b.periods.weeks[b.timeline.current.week].last.timeStamp})):b.timeline.scope.month&&12!=b.timeline.current.month&&(b.timeline.current.month++,b.timeliner.load({start:b.periods.months[b.timeline.current.month].first.timeStamp,end:b.periods.months[b.timeline.current.month].last.timeStamp}))},b.timelineThisWeek=function(){b.timeline.current.week!=(new Date).getWeek()&&(b.timeliner.load({start:b.periods.weeks[(new Date).getWeek()].first.timeStamp,end:b.periods.weeks[(new Date).getWeek()].last.timeStamp}),b.timeline.range={start:b.periods.weeks[(new Date).getWeek()].first.day,end:b.periods.weeks[(new Date).getWeek()].last.day})},b.timelineWeekBefore=function(){1!=b.timeline.current.week&&(b.timeline.current.week--,b.timeliner.load({start:b.periods.weeks[b.timeline.current.week].first.timeStamp,end:b.periods.weeks[b.timeline.current.week].last.timeStamp})),b.timeline.range={start:b.periods.weeks[b.timeline.current.week].first.day,end:b.periods.weeks[b.timeline.current.week].last.day}},b.timelineWeekAfter=function(){53!=b.timeline.current.week&&(b.timeline.current.week++,b.timeliner.load({start:b.periods.weeks[b.timeline.current.week].first.timeStamp,end:b.periods.weeks[b.timeline.current.week].last.timeStamp})),b.timeline.range={start:b.periods.weeks[b.timeline.current.week].first.day,end:b.periods.weeks[b.timeline.current.week].last.day}},b.timelineZoomIn=function(){b.self.timeline.zoom(a.config.timeline.config.zoom,Date.now())},b.timelineZoomOut=function(){b.self.timeline.zoom(-a.config.timeline.config.zoom,Date.now())},c.onresize=function(){b.self.timeline.redraw()},b.fullWidth=function(){console.log("ok!"),b.self.timeline.redraw()}}]),angular.module("WebPaige.Controllers.Messages",[]).controller("messagesCtrl",["$scope","$rootScope","$q","$location","$route","Messages","Storage","$filter","Teams",function(a,b,c,d,e,f,g,h,i){a.messages=[],a.imgHost=profile.host(),a.ns=profile.ns(),a.renderMessage=function(){f.queryTeamMessage(a.chatTeamId).then(function(c){if(c.error)return b.notifier.error(c.error.data),void 0;if(console.log(c.length,a.messages.length),a.messages.length==c.length)return console.log("No new messages."),void 0;a.messages=[];var d=[];c=h("orderBy")(c,"sendTime"),angular.forEach(c,function(b,e){var f=h("nicelyDate")(parseInt(b.sendTime));e>0&&f==h("nicelyDate")(parseInt(c[e-1].sendTime))&&(f="");var g={date:f,role:"",member:{},senderName:"",sendTime:parseInt(b.sendTime),body:b.body,msgRole:"",senderUuid:b.senderUuid},i=a.$root.getTeamMemberById(b.senderUuid);b.senderUuid==a.$root.app.resources.uuid?(g.role="own",g.msgRole="messageOwn",g.member=a.$root.app.resources,g.senderName=g.member.firstName+" "+g.member.lastName):(g.role="other",g.msgRole="messageOther",g.member=i,g.senderName=i.firstName+" "+i.lastName),a.messages.add(g),-1==d.indexOf(b.senderUuid)&&d.add(b.senderUuid)}),angular.forEach(d,function(b){console.log(b);var c=a.imgHost+a.ns+"/team/member/"+b+"/photourl";i.loadImg(c).then(function(c){var d=b.replace(".","").replace("@","");if(!c.status||404!=c.status&&403!=c.status&&500!=c.status){var e=a.imgHost+c.path;$("#chat-content #img_"+d).css("background-image","url("+e+")")}else console.log("no pics ",c)},function(a){console.log("error when load pic "+a)})}),setTimeout(function(){$("#chat-content #messageField").focus(),$("#chat-content").scrollTop($("#chat-content")[0].scrollHeight)},100)},function(a){console.log(a)})},a.openChat=function(){a.toggleChat=!a.toggleChat;var b=a.$root.app.resources.teamUuids;if(b&&a.toggleChat){var c=b[0];a.chatTeamId=c,a.renderMessage(),a.autoCheckMonitorId=setInterval(a.renderMessage,5e3)}else clearInterval(a.autoCheckMonitorId)},a.sendMessage=function(c){if("undefined"==typeof c||""==c)return b.notifier.error(b.ui.message.emptyMessageBody),void 0;b.statusBar.display(b.ui.message.sending);var d=new Date,e={title:"From Web-Paige"+d.toString(b.config.formats.date),body:c,sendTime:d.getTime()};console.log(e),f.sendTeamMessage(e).then(function(){a.renderMessage(),b.statusBar.off(),a.newMessage=""},function(a){b.notifier.error(a),b.statusBar.off()})}}]);